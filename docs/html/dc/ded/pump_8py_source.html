<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>yuh library: gtest-1.6.0/scripts/pump.py Source File</title>

<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">yuh library
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('dc/ded/pump_8py.html','../../');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">gtest-1.6.0/scripts/pump.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../dc/ded/pump_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="../../df/d92/namespacepump.html">00001</a> <span class="comment">#!/usr/bin/env python</span>
<a name="l00002"></a>00002 <span class="comment">#</span>
<a name="l00003"></a>00003 <span class="comment"># Copyright 2008, Google Inc.</span>
<a name="l00004"></a>00004 <span class="comment"># All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment">#</span>
<a name="l00006"></a>00006 <span class="comment"># Redistribution and use in source and binary forms, with or without</span>
<a name="l00007"></a>00007 <span class="comment"># modification, are permitted provided that the following conditions are</span>
<a name="l00008"></a>00008 <span class="comment"># met:</span>
<a name="l00009"></a>00009 <span class="comment">#</span>
<a name="l00010"></a>00010 <span class="comment">#     * Redistributions of source code must retain the above copyright</span>
<a name="l00011"></a>00011 <span class="comment"># notice, this list of conditions and the following disclaimer.</span>
<a name="l00012"></a>00012 <span class="comment">#     * Redistributions in binary form must reproduce the above</span>
<a name="l00013"></a>00013 <span class="comment"># copyright notice, this list of conditions and the following disclaimer</span>
<a name="l00014"></a>00014 <span class="comment"># in the documentation and/or other materials provided with the</span>
<a name="l00015"></a>00015 <span class="comment"># distribution.</span>
<a name="l00016"></a>00016 <span class="comment">#     * Neither the name of Google Inc. nor the names of its</span>
<a name="l00017"></a>00017 <span class="comment"># contributors may be used to endorse or promote products derived from</span>
<a name="l00018"></a>00018 <span class="comment"># this software without specific prior written permission.</span>
<a name="l00019"></a>00019 <span class="comment">#</span>
<a name="l00020"></a>00020 <span class="comment"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00021"></a>00021 <span class="comment"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00022"></a>00022 <span class="comment"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00023"></a>00023 <span class="comment"># A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00024"></a>00024 <span class="comment"># OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00025"></a>00025 <span class="comment"># SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00026"></a>00026 <span class="comment"># LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00027"></a>00027 <span class="comment"># DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00028"></a>00028 <span class="comment"># THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00029"></a>00029 <span class="comment"># (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00030"></a>00030 <span class="comment"># OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="stringliteral">&quot;&quot;&quot;pump v0.2.0 - Pretty Useful for Meta Programming.</span>
<a name="l00033"></a>00033 <span class="stringliteral"></span>
<a name="l00034"></a>00034 <span class="stringliteral">A tool for preprocessor meta programming.  Useful for generating</span>
<a name="l00035"></a>00035 <span class="stringliteral">repetitive boilerplate code.  Especially useful for writing C++</span>
<a name="l00036"></a>00036 <span class="stringliteral">classes, functions, macros, and templates that need to work with</span>
<a name="l00037"></a>00037 <span class="stringliteral">various number of arguments.</span>
<a name="l00038"></a>00038 <span class="stringliteral"></span>
<a name="l00039"></a>00039 <span class="stringliteral">USAGE:</span>
<a name="l00040"></a>00040 <span class="stringliteral">       pump.py SOURCE_FILE</span>
<a name="l00041"></a>00041 <span class="stringliteral"></span>
<a name="l00042"></a>00042 <span class="stringliteral">EXAMPLES:</span>
<a name="l00043"></a>00043 <span class="stringliteral">       pump.py foo.cc.pump</span>
<a name="l00044"></a>00044 <span class="stringliteral">         Converts foo.cc.pump to foo.cc.</span>
<a name="l00045"></a>00045 <span class="stringliteral"></span>
<a name="l00046"></a>00046 <span class="stringliteral">GRAMMAR:</span>
<a name="l00047"></a>00047 <span class="stringliteral">       CODE ::= ATOMIC_CODE*</span>
<a name="l00048"></a>00048 <span class="stringliteral">       ATOMIC_CODE ::= $var ID = EXPRESSION</span>
<a name="l00049"></a>00049 <span class="stringliteral">           | $var ID = [[ CODE ]]</span>
<a name="l00050"></a>00050 <span class="stringliteral">           | $range ID EXPRESSION..EXPRESSION</span>
<a name="l00051"></a>00051 <span class="stringliteral">           | $for ID SEPARATOR [[ CODE ]]</span>
<a name="l00052"></a>00052 <span class="stringliteral">           | $($)</span>
<a name="l00053"></a>00053 <span class="stringliteral">           | $ID</span>
<a name="l00054"></a>00054 <span class="stringliteral">           | $(EXPRESSION)</span>
<a name="l00055"></a>00055 <span class="stringliteral">           | $if EXPRESSION [[ CODE ]] ELSE_BRANCH</span>
<a name="l00056"></a>00056 <span class="stringliteral">           | [[ CODE ]]</span>
<a name="l00057"></a>00057 <span class="stringliteral">           | RAW_CODE</span>
<a name="l00058"></a>00058 <span class="stringliteral">       SEPARATOR ::= RAW_CODE | EMPTY</span>
<a name="l00059"></a>00059 <span class="stringliteral">       ELSE_BRANCH ::= $else [[ CODE ]]</span>
<a name="l00060"></a>00060 <span class="stringliteral">           | $elif EXPRESSION [[ CODE ]] ELSE_BRANCH</span>
<a name="l00061"></a>00061 <span class="stringliteral">           | EMPTY</span>
<a name="l00062"></a>00062 <span class="stringliteral">       EXPRESSION has Python syntax.</span>
<a name="l00063"></a>00063 <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="../../df/d92/namespacepump.html#a629d61dfe4da763164a4d1a2d85b0afd">00065</a> __author__ = <span class="stringliteral">&#39;wan@google.com (Zhanyong Wan)&#39;</span>
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="keyword">import</span> os
<a name="l00068"></a>00068 <span class="keyword">import</span> re
<a name="l00069"></a>00069 <span class="keyword">import</span> sys
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a><a class="code" href="../../df/d92/namespacepump.html#a6bd373dabbdfeaf3ec7a5e80d5bba44f">00072</a> TOKEN_TABLE = [
<a name="l00073"></a>00073     (re.compile(<span class="stringliteral">r&#39;\$var\s+&#39;</span>), <span class="stringliteral">&#39;$var&#39;</span>),
<a name="l00074"></a>00074     (re.compile(<span class="stringliteral">r&#39;\$elif\s+&#39;</span>), <span class="stringliteral">&#39;$elif&#39;</span>),
<a name="l00075"></a>00075     (re.compile(<span class="stringliteral">r&#39;\$else\s+&#39;</span>), <span class="stringliteral">&#39;$else&#39;</span>),
<a name="l00076"></a>00076     (re.compile(<span class="stringliteral">r&#39;\$for\s+&#39;</span>), <span class="stringliteral">&#39;$for&#39;</span>),
<a name="l00077"></a>00077     (re.compile(<span class="stringliteral">r&#39;\$if\s+&#39;</span>), <span class="stringliteral">&#39;$if&#39;</span>),
<a name="l00078"></a>00078     (re.compile(<span class="stringliteral">r&#39;\$range\s+&#39;</span>), <span class="stringliteral">&#39;$range&#39;</span>),
<a name="l00079"></a>00079     (re.compile(<span class="stringliteral">r&#39;\$[_A-Za-z]\w*&#39;</span>), <span class="stringliteral">&#39;$id&#39;</span>),
<a name="l00080"></a>00080     (re.compile(<span class="stringliteral">r&#39;\$\(\$\)&#39;</span>), <span class="stringliteral">&#39;$($)&#39;</span>),
<a name="l00081"></a>00081     (re.compile(<span class="stringliteral">r&#39;\$&#39;</span>), <span class="stringliteral">&#39;$&#39;</span>),
<a name="l00082"></a>00082     (re.compile(<span class="stringliteral">r&#39;\[\[\n?&#39;</span>), <span class="stringliteral">&#39;[[&#39;</span>),
<a name="l00083"></a>00083     (re.compile(<span class="stringliteral">r&#39;\]\]\n?&#39;</span>), <span class="stringliteral">&#39;]]&#39;</span>),
<a name="l00084"></a>00084     ]
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="../../dd/da8/classpump_1_1Cursor.html">00087</a> <span class="keyword">class </span><a class="code" href="../../dd/da8/classpump_1_1Cursor.html">Cursor</a>:
<a name="l00088"></a>00088   <span class="stringliteral">&quot;&quot;&quot;Represents a position (line and column) in a text file.&quot;&quot;&quot;</span>
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a4fa05b1f00fcde100685cc887554b93b">00090</a>   <span class="keyword">def </span><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, line=-1, column=-1):
<a name="l00091"></a>00091     self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a4fa05b1f00fcde100685cc887554b93b">line</a> = line
<a name="l00092"></a>00092     self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#ae78e6e11a40e6dba1bae097358f97d15">column</a> = column
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a449f8fd74d358c0ad641b6c6d6917ba0">00094</a>   <span class="keyword">def </span><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a449f8fd74d358c0ad641b6c6d6917ba0">__eq__</a>(self, rhs):
<a name="l00095"></a>00095     <span class="keywordflow">return</span> self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a4fa05b1f00fcde100685cc887554b93b">line</a> == rhs.line <span class="keywordflow">and</span> self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#ae78e6e11a40e6dba1bae097358f97d15">column</a> == rhs.column
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#ad69df72a6bf0be3525fe45cd2f77f343">00097</a>   <span class="keyword">def </span><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#ad69df72a6bf0be3525fe45cd2f77f343">__ne__</a>(self, rhs):
<a name="l00098"></a>00098     <span class="keywordflow">return</span> <span class="keywordflow">not</span> self == rhs
<a name="l00099"></a>00099 
<a name="l00100"></a><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a6a45920abc8ecf2d458d174ea7304f8a">00100</a>   <span class="keyword">def </span><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a6a45920abc8ecf2d458d174ea7304f8a">__lt__</a>(self, rhs):
<a name="l00101"></a>00101     <span class="keywordflow">return</span> self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a4fa05b1f00fcde100685cc887554b93b">line</a> &lt; rhs.line <span class="keywordflow">or</span> (
<a name="l00102"></a>00102         self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a4fa05b1f00fcde100685cc887554b93b">line</a> == rhs.line <span class="keywordflow">and</span> self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#ae78e6e11a40e6dba1bae097358f97d15">column</a> &lt; rhs.column)
<a name="l00103"></a>00103 
<a name="l00104"></a><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a83166e4aabc2805e71aef3a43f016181">00104</a>   <span class="keyword">def </span><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a83166e4aabc2805e71aef3a43f016181">__le__</a>(self, rhs):
<a name="l00105"></a>00105     <span class="keywordflow">return</span> self &lt; rhs <span class="keywordflow">or</span> self == rhs
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a728aec3eafa75fd847ce0bf8f954efde">00107</a>   <span class="keyword">def </span><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a728aec3eafa75fd847ce0bf8f954efde">__gt__</a>(self, rhs):
<a name="l00108"></a>00108     <span class="keywordflow">return</span> rhs &lt; self
<a name="l00109"></a>00109 
<a name="l00110"></a><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a3ee81c22a31860655ba6bf83ff5a8f36">00110</a>   <span class="keyword">def </span><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a3ee81c22a31860655ba6bf83ff5a8f36">__ge__</a>(self, rhs):
<a name="l00111"></a>00111     <span class="keywordflow">return</span> rhs &lt;= self
<a name="l00112"></a>00112 
<a name="l00113"></a><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#aa7a4b9bc0941308e362738503137460e">00113</a>   <span class="keyword">def </span><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#aa7a4b9bc0941308e362738503137460e">__str__</a>(self):
<a name="l00114"></a>00114     <span class="keywordflow">if</span> self == <a class="code" href="../../df/d92/namespacepump.html#ace406cec139528a5aa1640edf8dbebe6">Eof</a>():
<a name="l00115"></a>00115       <span class="keywordflow">return</span> <span class="stringliteral">&#39;EOF&#39;</span>
<a name="l00116"></a>00116     <span class="keywordflow">else</span>:
<a name="l00117"></a>00117       <span class="keywordflow">return</span> <span class="stringliteral">&#39;%s(%s)&#39;</span> % (self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a4fa05b1f00fcde100685cc887554b93b">line</a> + 1, self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#ae78e6e11a40e6dba1bae097358f97d15">column</a>)
<a name="l00118"></a>00118 
<a name="l00119"></a><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#ae92943b217d29a45ddcbbba2f7208afc">00119</a>   <span class="keyword">def </span><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#ae92943b217d29a45ddcbbba2f7208afc">__add__</a>(self, offset):
<a name="l00120"></a>00120     <span class="keywordflow">return</span> <a class="code" href="../../dd/da8/classpump_1_1Cursor.html">Cursor</a>(self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#ae78e6e11a40e6dba1bae097358f97d15">column</a> + offset)
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a92f51217c100657d0bf6f97b150c0a7c">00122</a>   <span class="keyword">def </span><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a92f51217c100657d0bf6f97b150c0a7c">__sub__</a>(self, offset):
<a name="l00123"></a>00123     <span class="keywordflow">return</span> <a class="code" href="../../dd/da8/classpump_1_1Cursor.html">Cursor</a>(self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#ae78e6e11a40e6dba1bae097358f97d15">column</a> - offset)
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#aff981755ef197de06774d0c1cf6cceb9">00125</a>   <span class="keyword">def </span><a class="code" href="../../dd/da8/classpump_1_1Cursor.html#aff981755ef197de06774d0c1cf6cceb9">Clone</a>(self):
<a name="l00126"></a>00126     <span class="stringliteral">&quot;&quot;&quot;Returns a copy of self.&quot;&quot;&quot;</span>
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <span class="keywordflow">return</span> <a class="code" href="../../dd/da8/classpump_1_1Cursor.html">Cursor</a>(self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#a4fa05b1f00fcde100685cc887554b93b">line</a>, self.<a class="code" href="../../dd/da8/classpump_1_1Cursor.html#ae78e6e11a40e6dba1bae097358f97d15">column</a>)
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 <span class="comment"># Special cursor to indicate the end-of-file.</span>
<a name="l00132"></a><a class="code" href="../../df/d92/namespacepump.html#ace406cec139528a5aa1640edf8dbebe6">00132</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#ace406cec139528a5aa1640edf8dbebe6">Eof</a>():
<a name="l00133"></a>00133   <span class="stringliteral">&quot;&quot;&quot;Returns the special cursor to denote the end-of-file.&quot;&quot;&quot;</span>
<a name="l00134"></a>00134   <span class="keywordflow">return</span> <a class="code" href="../../dd/da8/classpump_1_1Cursor.html">Cursor</a>(-1, -1)
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 
<a name="l00137"></a><a class="code" href="../../d2/ddc/classpump_1_1Token.html">00137</a> <span class="keyword">class </span><a class="code" href="../../d2/ddc/classpump_1_1Token.html">Token</a>:
<a name="l00138"></a>00138   <span class="stringliteral">&quot;&quot;&quot;Represents a token in a Pump source file.&quot;&quot;&quot;</span>
<a name="l00139"></a>00139 
<a name="l00140"></a><a class="code" href="../../d2/ddc/classpump_1_1Token.html#afcc7a4b78ecd8fa7e713f8cfa0f51017">00140</a>   <span class="keyword">def </span><a class="code" href="../../d2/ddc/classpump_1_1Token.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, start=None, end=None, value=None, token_type=None):
<a name="l00141"></a>00141     <span class="keywordflow">if</span> start <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00142"></a>00142       self.<a class="code" href="../../d2/ddc/classpump_1_1Token.html#a550769bbd4e7537ff90a656f5b0c23b2">start</a> = <a class="code" href="../../df/d92/namespacepump.html#ace406cec139528a5aa1640edf8dbebe6">Eof</a>()
<a name="l00143"></a>00143     <span class="keywordflow">else</span>:
<a name="l00144"></a>00144       self.<a class="code" href="../../d2/ddc/classpump_1_1Token.html#a550769bbd4e7537ff90a656f5b0c23b2">start</a> = start
<a name="l00145"></a>00145     <span class="keywordflow">if</span> end <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00146"></a>00146       self.<a class="code" href="../../d2/ddc/classpump_1_1Token.html#afb358f48b1646c750fb9da6c6585be2b">end</a> = <a class="code" href="../../df/d92/namespacepump.html#ace406cec139528a5aa1640edf8dbebe6">Eof</a>()
<a name="l00147"></a>00147     <span class="keywordflow">else</span>:
<a name="l00148"></a>00148       self.<a class="code" href="../../d2/ddc/classpump_1_1Token.html#afb358f48b1646c750fb9da6c6585be2b">end</a> = end
<a name="l00149"></a>00149     self.<a class="code" href="../../d2/ddc/classpump_1_1Token.html#afcc7a4b78ecd8fa7e713f8cfa0f51017">value</a> = value
<a name="l00150"></a>00150     self.<a class="code" href="../../d2/ddc/classpump_1_1Token.html#afe5ef662303b6b710ea6ee1a944bad0d">token_type</a> = token_type
<a name="l00151"></a>00151 
<a name="l00152"></a><a class="code" href="../../d2/ddc/classpump_1_1Token.html#aa7a4b9bc0941308e362738503137460e">00152</a>   <span class="keyword">def </span><a class="code" href="../../d2/ddc/classpump_1_1Token.html#aa7a4b9bc0941308e362738503137460e">__str__</a>(self):
<a name="l00153"></a>00153     <span class="keywordflow">return</span> <span class="stringliteral">&#39;Token @%s: \&#39;%s\&#39; type=%s&#39;</span> % (
<a name="l00154"></a>00154         self.<a class="code" href="../../d2/ddc/classpump_1_1Token.html#a550769bbd4e7537ff90a656f5b0c23b2">start</a>, self.<a class="code" href="../../d2/ddc/classpump_1_1Token.html#afcc7a4b78ecd8fa7e713f8cfa0f51017">value</a>, self.<a class="code" href="../../d2/ddc/classpump_1_1Token.html#afe5ef662303b6b710ea6ee1a944bad0d">token_type</a>)
<a name="l00155"></a>00155 
<a name="l00156"></a><a class="code" href="../../d2/ddc/classpump_1_1Token.html#aff981755ef197de06774d0c1cf6cceb9">00156</a>   <span class="keyword">def </span><a class="code" href="../../d2/ddc/classpump_1_1Token.html#aff981755ef197de06774d0c1cf6cceb9">Clone</a>(self):
<a name="l00157"></a>00157     <span class="stringliteral">&quot;&quot;&quot;Returns a copy of self.&quot;&quot;&quot;</span>
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/classpump_1_1Token.html">Token</a>(self.start.Clone(), self.end.Clone(), self.<a class="code" href="../../d2/ddc/classpump_1_1Token.html#afcc7a4b78ecd8fa7e713f8cfa0f51017">value</a>,
<a name="l00160"></a>00160                  self.<a class="code" href="../../d2/ddc/classpump_1_1Token.html#afe5ef662303b6b710ea6ee1a944bad0d">token_type</a>)
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 
<a name="l00163"></a><a class="code" href="../../df/d92/namespacepump.html#a291b93315bfdd697deaee88680502c00">00163</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a291b93315bfdd697deaee88680502c00">StartsWith</a>(lines, pos, string):
<a name="l00164"></a>00164   <span class="stringliteral">&quot;&quot;&quot;Returns True iff the given position in lines starts with &#39;string&#39;.&quot;&quot;&quot;</span>
<a name="l00165"></a>00165 
<a name="l00166"></a>00166   <span class="keywordflow">return</span> lines[pos.line][pos.column:].startswith(string)
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 
<a name="l00169"></a><a class="code" href="../../df/d92/namespacepump.html#acca697b3cc5adc6044b115e9e16c019e">00169</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#acca697b3cc5adc6044b115e9e16c019e">FindFirstInLine</a>(line, token_table):
<a name="l00170"></a>00170   best_match_start = -1
<a name="l00171"></a>00171   <span class="keywordflow">for</span> (regex, token_type) <span class="keywordflow">in</span> token_table:
<a name="l00172"></a>00172     m = regex.search(line)
<a name="l00173"></a>00173     <span class="keywordflow">if</span> m:
<a name="l00174"></a>00174       <span class="comment"># We found regex in lines</span>
<a name="l00175"></a>00175       <span class="keywordflow">if</span> best_match_start &lt; 0 <span class="keywordflow">or</span> m.start() &lt; best_match_start:
<a name="l00176"></a>00176         best_match_start = m.start()
<a name="l00177"></a>00177         best_match_length = m.end() - m.start()
<a name="l00178"></a>00178         best_match_token_type = token_type
<a name="l00179"></a>00179 
<a name="l00180"></a>00180   <span class="keywordflow">if</span> best_match_start &lt; 0:
<a name="l00181"></a>00181     <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183   <span class="keywordflow">return</span> (best_match_start, best_match_length, best_match_token_type)
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="../../df/d92/namespacepump.html#a9713ad82d1c87f60ad986c6ce96f0002">00186</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a9713ad82d1c87f60ad986c6ce96f0002">FindFirst</a>(lines, token_table, cursor):
<a name="l00187"></a>00187   <span class="stringliteral">&quot;&quot;&quot;Finds the first occurrence of any string in strings in lines.&quot;&quot;&quot;</span>
<a name="l00188"></a>00188 
<a name="l00189"></a>00189   start = cursor.Clone()
<a name="l00190"></a>00190   cur_line_number = cursor.line
<a name="l00191"></a>00191   <span class="keywordflow">for</span> line <span class="keywordflow">in</span> lines[start.line:]:
<a name="l00192"></a>00192     <span class="keywordflow">if</span> cur_line_number == start.line:
<a name="l00193"></a>00193       line = line[start.column:]
<a name="l00194"></a>00194     m = <a class="code" href="../../df/d92/namespacepump.html#acca697b3cc5adc6044b115e9e16c019e">FindFirstInLine</a>(line, token_table)
<a name="l00195"></a>00195     <span class="keywordflow">if</span> m:
<a name="l00196"></a>00196       <span class="comment"># We found a regex in line.</span>
<a name="l00197"></a>00197       (start_column, length, token_type) = m
<a name="l00198"></a>00198       <span class="keywordflow">if</span> cur_line_number == start.line:
<a name="l00199"></a>00199         start_column += start.column
<a name="l00200"></a>00200       found_start = <a class="code" href="../../dd/da8/classpump_1_1Cursor.html">Cursor</a>(cur_line_number, start_column)
<a name="l00201"></a>00201       found_end = found_start + length
<a name="l00202"></a>00202       <span class="keywordflow">return</span> <a class="code" href="../../df/d92/namespacepump.html#ae95150dec49136d71303f5f4239dd5b6">MakeToken</a>(lines, found_start, found_end, token_type)
<a name="l00203"></a>00203     cur_line_number += 1
<a name="l00204"></a>00204   <span class="comment"># We failed to find str in lines</span>
<a name="l00205"></a>00205   <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 
<a name="l00208"></a><a class="code" href="../../df/d92/namespacepump.html#a0d1ed8e160c333130bd8f84c8fe457e5">00208</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a0d1ed8e160c333130bd8f84c8fe457e5">SubString</a>(lines, start, end):
<a name="l00209"></a>00209   <span class="stringliteral">&quot;&quot;&quot;Returns a substring in lines.&quot;&quot;&quot;</span>
<a name="l00210"></a>00210 
<a name="l00211"></a>00211   <span class="keywordflow">if</span> end == <a class="code" href="../../df/d92/namespacepump.html#ace406cec139528a5aa1640edf8dbebe6">Eof</a>():
<a name="l00212"></a>00212     end = <a class="code" href="../../dd/da8/classpump_1_1Cursor.html">Cursor</a>(len(lines) - 1, len(lines[-1]))
<a name="l00213"></a>00213 
<a name="l00214"></a>00214   <span class="keywordflow">if</span> start &gt;= end:
<a name="l00215"></a>00215     <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>
<a name="l00216"></a>00216 
<a name="l00217"></a>00217   <span class="keywordflow">if</span> start.line == end.line:
<a name="l00218"></a>00218     <span class="keywordflow">return</span> lines[start.line][start.column:end.column]
<a name="l00219"></a>00219 
<a name="l00220"></a>00220   result_lines = ([lines[start.line][start.column:]] +
<a name="l00221"></a>00221                   lines[start.line + 1:end.line] +
<a name="l00222"></a>00222                   [lines[end.line][:end.column]])
<a name="l00223"></a>00223   <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>.join(result_lines)
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 
<a name="l00226"></a><a class="code" href="../../df/d92/namespacepump.html#a23b6bb138dc055b93b9d13d0b092a725">00226</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a23b6bb138dc055b93b9d13d0b092a725">StripMetaComments</a>(str):
<a name="l00227"></a>00227   <span class="stringliteral">&quot;&quot;&quot;Strip meta comments from each line in the given string.&quot;&quot;&quot;</span>
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   <span class="comment"># First, completely remove lines containing nothing but a meta</span>
<a name="l00230"></a>00230   <span class="comment"># comment, including the trailing \n.</span>
<a name="l00231"></a>00231   str = re.sub(<span class="stringliteral">r&#39;^\s*\$\$.*\n&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, str)
<a name="l00232"></a>00232 
<a name="l00233"></a>00233   <span class="comment"># Then, remove meta comments from contentful lines.</span>
<a name="l00234"></a>00234   <span class="keywordflow">return</span> re.sub(<span class="stringliteral">r&#39;\s*\$\$.*&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, str)
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 
<a name="l00237"></a><a class="code" href="../../df/d92/namespacepump.html#ae95150dec49136d71303f5f4239dd5b6">00237</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#ae95150dec49136d71303f5f4239dd5b6">MakeToken</a>(lines, start, end, token_type):
<a name="l00238"></a>00238   <span class="stringliteral">&quot;&quot;&quot;Creates a new instance of Token.&quot;&quot;&quot;</span>
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/classpump_1_1Token.html">Token</a>(start, end, <a class="code" href="../../df/d92/namespacepump.html#a0d1ed8e160c333130bd8f84c8fe457e5">SubString</a>(lines, start, end), token_type)
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 
<a name="l00243"></a><a class="code" href="../../df/d92/namespacepump.html#a85396ae3b56877c067788f45b163eff5">00243</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a85396ae3b56877c067788f45b163eff5">ParseToken</a>(lines, pos, regex, token_type):
<a name="l00244"></a>00244   line = lines[pos.line][pos.column:]
<a name="l00245"></a>00245   m = regex.search(line)
<a name="l00246"></a>00246   <span class="keywordflow">if</span> m <span class="keywordflow">and</span> <span class="keywordflow">not</span> m.start():
<a name="l00247"></a>00247     <span class="keywordflow">return</span> <a class="code" href="../../df/d92/namespacepump.html#ae95150dec49136d71303f5f4239dd5b6">MakeToken</a>(lines, pos, pos + m.end(), token_type)
<a name="l00248"></a>00248   <span class="keywordflow">else</span>:
<a name="l00249"></a>00249     <span class="keywordflow">print</span> <span class="stringliteral">&#39;ERROR: %s expected at %s.&#39;</span> % (token_type, pos)
<a name="l00250"></a>00250     sys.exit(1)
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 
<a name="l00253"></a><a class="code" href="../../df/d92/namespacepump.html#a72ec68ae8b1a6794caed2e023ad35d0d">00253</a> ID_REGEX = re.compile(<span class="stringliteral">r&#39;[_A-Za-z]\w*&#39;</span>)
<a name="l00254"></a><a class="code" href="../../df/d92/namespacepump.html#a89c455f059588c995485f69128edcb04">00254</a> EQ_REGEX = re.compile(<span class="stringliteral">r&#39;=&#39;</span>)
<a name="l00255"></a><a class="code" href="../../df/d92/namespacepump.html#a3a8b691d5bf29c19ae673e3f3b8aeb03">00255</a> REST_OF_LINE_REGEX = re.compile(<span class="stringliteral">r&#39;.*?(?=$|\$\$)&#39;</span>)
<a name="l00256"></a><a class="code" href="../../df/d92/namespacepump.html#a72547bba10d6b0d28381a17d46fcddff">00256</a> OPTIONAL_WHITE_SPACES_REGEX = re.compile(<span class="stringliteral">r&#39;\s*&#39;</span>)
<a name="l00257"></a><a class="code" href="../../df/d92/namespacepump.html#afdbcc81876235b538ea355fcd2193bbd">00257</a> WHITE_SPACE_REGEX = re.compile(<span class="stringliteral">r&#39;\s&#39;</span>)
<a name="l00258"></a><a class="code" href="../../df/d92/namespacepump.html#a5267421d4c85117b52d918accf1b2cbe">00258</a> DOT_DOT_REGEX = re.compile(<span class="stringliteral">r&#39;\.\.&#39;</span>)
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 
<a name="l00261"></a><a class="code" href="../../df/d92/namespacepump.html#a2a4a78c5cca4b815e2f323eba9245dd4">00261</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a2a4a78c5cca4b815e2f323eba9245dd4">Skip</a>(lines, pos, regex):
<a name="l00262"></a>00262   line = lines[pos.line][pos.column:]
<a name="l00263"></a>00263   m = re.search(regex, line)
<a name="l00264"></a>00264   <span class="keywordflow">if</span> m <span class="keywordflow">and</span> <span class="keywordflow">not</span> m.start():
<a name="l00265"></a>00265     <span class="keywordflow">return</span> pos + m.end()
<a name="l00266"></a>00266   <span class="keywordflow">else</span>:
<a name="l00267"></a>00267     <span class="keywordflow">return</span> pos
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 
<a name="l00270"></a><a class="code" href="../../df/d92/namespacepump.html#a14ce849109475f0297844fb68697f5ef">00270</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a14ce849109475f0297844fb68697f5ef">SkipUntil</a>(lines, pos, regex, token_type):
<a name="l00271"></a>00271   line = lines[pos.line][pos.column:]
<a name="l00272"></a>00272   m = re.search(regex, line)
<a name="l00273"></a>00273   <span class="keywordflow">if</span> m:
<a name="l00274"></a>00274     <span class="keywordflow">return</span> pos + m.start()
<a name="l00275"></a>00275   <span class="keywordflow">else</span>:
<a name="l00276"></a>00276     <span class="keywordflow">print</span> (<span class="stringliteral">&#39;ERROR: %s expected on line %s after column %s.&#39;</span> %
<a name="l00277"></a>00277            (token_type, pos.line + 1, pos.column))
<a name="l00278"></a>00278     sys.exit(1)
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 
<a name="l00281"></a><a class="code" href="../../df/d92/namespacepump.html#a44d91c490d21a9119501d099e6caf547">00281</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a44d91c490d21a9119501d099e6caf547">ParseExpTokenInParens</a>(lines, pos):
<a name="l00282"></a>00282   <span class="keyword">def </span>ParseInParens(pos):
<a name="l00283"></a>00283     pos = <a class="code" href="../../df/d92/namespacepump.html#a2a4a78c5cca4b815e2f323eba9245dd4">Skip</a>(lines, pos, OPTIONAL_WHITE_SPACES_REGEX)
<a name="l00284"></a>00284     pos = <a class="code" href="../../df/d92/namespacepump.html#a2a4a78c5cca4b815e2f323eba9245dd4">Skip</a>(lines, pos, <span class="stringliteral">r&#39;\(&#39;</span>)
<a name="l00285"></a>00285     pos = Parse(pos)
<a name="l00286"></a>00286     pos = <a class="code" href="../../df/d92/namespacepump.html#a2a4a78c5cca4b815e2f323eba9245dd4">Skip</a>(lines, pos, <span class="stringliteral">r&#39;\)&#39;</span>)
<a name="l00287"></a>00287     <span class="keywordflow">return</span> pos
<a name="l00288"></a>00288 
<a name="l00289"></a>00289   <span class="keyword">def </span>Parse(pos):
<a name="l00290"></a>00290     pos = <a class="code" href="../../df/d92/namespacepump.html#a14ce849109475f0297844fb68697f5ef">SkipUntil</a>(lines, pos, <span class="stringliteral">r&#39;\(|\)&#39;</span>, <span class="stringliteral">&#39;)&#39;</span>)
<a name="l00291"></a>00291     <span class="keywordflow">if</span> <a class="code" href="../../df/d92/namespacepump.html#a0d1ed8e160c333130bd8f84c8fe457e5">SubString</a>(lines, pos, pos + 1) == <span class="stringliteral">&#39;(&#39;</span>:
<a name="l00292"></a>00292       pos = Parse(pos + 1)
<a name="l00293"></a>00293       pos = <a class="code" href="../../df/d92/namespacepump.html#a2a4a78c5cca4b815e2f323eba9245dd4">Skip</a>(lines, pos, <span class="stringliteral">r&#39;\)&#39;</span>)
<a name="l00294"></a>00294       <span class="keywordflow">return</span> Parse(pos)
<a name="l00295"></a>00295     <span class="keywordflow">else</span>:
<a name="l00296"></a>00296       <span class="keywordflow">return</span> pos
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   start = pos.Clone()
<a name="l00299"></a>00299   pos = ParseInParens(pos)
<a name="l00300"></a>00300   <span class="keywordflow">return</span> <a class="code" href="../../df/d92/namespacepump.html#ae95150dec49136d71303f5f4239dd5b6">MakeToken</a>(lines, start, pos, <span class="stringliteral">&#39;exp&#39;</span>)
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 
<a name="l00303"></a><a class="code" href="../../df/d92/namespacepump.html#ad52cab2935ab52c2ff26aac5196a1ace">00303</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#ad52cab2935ab52c2ff26aac5196a1ace">RStripNewLineFromToken</a>(token):
<a name="l00304"></a>00304   <span class="keywordflow">if</span> token.value.endswith(<span class="stringliteral">&#39;\n&#39;</span>):
<a name="l00305"></a>00305     <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/classpump_1_1Token.html">Token</a>(token.start, token.end, token.value[:-1], token.token_type)
<a name="l00306"></a>00306   <span class="keywordflow">else</span>:
<a name="l00307"></a>00307     <span class="keywordflow">return</span> token
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 
<a name="l00310"></a><a class="code" href="../../df/d92/namespacepump.html#abbbf5e37a9a7dda79d6c53a99f373e27">00310</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#abbbf5e37a9a7dda79d6c53a99f373e27">TokenizeLines</a>(lines, pos):
<a name="l00311"></a>00311   <span class="keywordflow">while</span> <span class="keyword">True</span>:
<a name="l00312"></a>00312     found = <a class="code" href="../../df/d92/namespacepump.html#a9713ad82d1c87f60ad986c6ce96f0002">FindFirst</a>(lines, TOKEN_TABLE, pos)
<a name="l00313"></a>00313     <span class="keywordflow">if</span> <span class="keywordflow">not</span> found:
<a name="l00314"></a>00314       <span class="keywordflow">yield</span> <a class="code" href="../../df/d92/namespacepump.html#ae95150dec49136d71303f5f4239dd5b6">MakeToken</a>(lines, pos, <a class="code" href="../../df/d92/namespacepump.html#ace406cec139528a5aa1640edf8dbebe6">Eof</a>(), <span class="stringliteral">&#39;code&#39;</span>)
<a name="l00315"></a>00315       <span class="keywordflow">return</span>
<a name="l00316"></a>00316 
<a name="l00317"></a>00317     <span class="keywordflow">if</span> found.start == pos:
<a name="l00318"></a>00318       prev_token = <span class="keywordtype">None</span>
<a name="l00319"></a>00319       prev_token_rstripped = <span class="keywordtype">None</span>
<a name="l00320"></a>00320     <span class="keywordflow">else</span>:
<a name="l00321"></a>00321       prev_token = <a class="code" href="../../df/d92/namespacepump.html#ae95150dec49136d71303f5f4239dd5b6">MakeToken</a>(lines, pos, found.start, <span class="stringliteral">&#39;code&#39;</span>)
<a name="l00322"></a>00322       prev_token_rstripped = <a class="code" href="../../df/d92/namespacepump.html#ad52cab2935ab52c2ff26aac5196a1ace">RStripNewLineFromToken</a>(prev_token)
<a name="l00323"></a>00323 
<a name="l00324"></a>00324     <span class="keywordflow">if</span> found.token_type == <span class="stringliteral">&#39;$var&#39;</span>:
<a name="l00325"></a>00325       <span class="keywordflow">if</span> prev_token_rstripped:
<a name="l00326"></a>00326         <span class="keywordflow">yield</span> prev_token_rstripped
<a name="l00327"></a>00327       <span class="keywordflow">yield</span> found
<a name="l00328"></a>00328       id_token = <a class="code" href="../../df/d92/namespacepump.html#a85396ae3b56877c067788f45b163eff5">ParseToken</a>(lines, found.end, ID_REGEX, <span class="stringliteral">&#39;id&#39;</span>)
<a name="l00329"></a>00329       <span class="keywordflow">yield</span> id_token
<a name="l00330"></a>00330       pos = <a class="code" href="../../df/d92/namespacepump.html#a2a4a78c5cca4b815e2f323eba9245dd4">Skip</a>(lines, id_token.end, OPTIONAL_WHITE_SPACES_REGEX)
<a name="l00331"></a>00331 
<a name="l00332"></a>00332       eq_token = <a class="code" href="../../df/d92/namespacepump.html#a85396ae3b56877c067788f45b163eff5">ParseToken</a>(lines, pos, EQ_REGEX, <span class="stringliteral">&#39;=&#39;</span>)
<a name="l00333"></a>00333       <span class="keywordflow">yield</span> eq_token
<a name="l00334"></a>00334       pos = <a class="code" href="../../df/d92/namespacepump.html#a2a4a78c5cca4b815e2f323eba9245dd4">Skip</a>(lines, eq_token.end, <span class="stringliteral">r&#39;\s*&#39;</span>)
<a name="l00335"></a>00335 
<a name="l00336"></a>00336       <span class="keywordflow">if</span> <a class="code" href="../../df/d92/namespacepump.html#a0d1ed8e160c333130bd8f84c8fe457e5">SubString</a>(lines, pos, pos + 2) != <span class="stringliteral">&#39;[[&#39;</span>:
<a name="l00337"></a>00337         exp_token = <a class="code" href="../../df/d92/namespacepump.html#a85396ae3b56877c067788f45b163eff5">ParseToken</a>(lines, pos, REST_OF_LINE_REGEX, <span class="stringliteral">&#39;exp&#39;</span>)
<a name="l00338"></a>00338         <span class="keywordflow">yield</span> exp_token
<a name="l00339"></a>00339         pos = <a class="code" href="../../dd/da8/classpump_1_1Cursor.html">Cursor</a>(exp_token.end.line + 1, 0)
<a name="l00340"></a>00340     <span class="keywordflow">elif</span> found.token_type == <span class="stringliteral">&#39;$for&#39;</span>:
<a name="l00341"></a>00341       <span class="keywordflow">if</span> prev_token_rstripped:
<a name="l00342"></a>00342         <span class="keywordflow">yield</span> prev_token_rstripped
<a name="l00343"></a>00343       <span class="keywordflow">yield</span> found
<a name="l00344"></a>00344       id_token = <a class="code" href="../../df/d92/namespacepump.html#a85396ae3b56877c067788f45b163eff5">ParseToken</a>(lines, found.end, ID_REGEX, <span class="stringliteral">&#39;id&#39;</span>)
<a name="l00345"></a>00345       <span class="keywordflow">yield</span> id_token
<a name="l00346"></a>00346       pos = <a class="code" href="../../df/d92/namespacepump.html#a2a4a78c5cca4b815e2f323eba9245dd4">Skip</a>(lines, id_token.end, WHITE_SPACE_REGEX)
<a name="l00347"></a>00347     <span class="keywordflow">elif</span> found.token_type == <span class="stringliteral">&#39;$range&#39;</span>:
<a name="l00348"></a>00348       <span class="keywordflow">if</span> prev_token_rstripped:
<a name="l00349"></a>00349         <span class="keywordflow">yield</span> prev_token_rstripped
<a name="l00350"></a>00350       <span class="keywordflow">yield</span> found
<a name="l00351"></a>00351       id_token = <a class="code" href="../../df/d92/namespacepump.html#a85396ae3b56877c067788f45b163eff5">ParseToken</a>(lines, found.end, ID_REGEX, <span class="stringliteral">&#39;id&#39;</span>)
<a name="l00352"></a>00352       <span class="keywordflow">yield</span> id_token
<a name="l00353"></a>00353       pos = <a class="code" href="../../df/d92/namespacepump.html#a2a4a78c5cca4b815e2f323eba9245dd4">Skip</a>(lines, id_token.end, OPTIONAL_WHITE_SPACES_REGEX)
<a name="l00354"></a>00354 
<a name="l00355"></a>00355       dots_pos = <a class="code" href="../../df/d92/namespacepump.html#a14ce849109475f0297844fb68697f5ef">SkipUntil</a>(lines, pos, DOT_DOT_REGEX, <span class="stringliteral">&#39;..&#39;</span>)
<a name="l00356"></a>00356       <span class="keywordflow">yield</span> <a class="code" href="../../df/d92/namespacepump.html#ae95150dec49136d71303f5f4239dd5b6">MakeToken</a>(lines, pos, dots_pos, <span class="stringliteral">&#39;exp&#39;</span>)
<a name="l00357"></a>00357       <span class="keywordflow">yield</span> <a class="code" href="../../df/d92/namespacepump.html#ae95150dec49136d71303f5f4239dd5b6">MakeToken</a>(lines, dots_pos, dots_pos + 2, <span class="stringliteral">&#39;..&#39;</span>)
<a name="l00358"></a>00358       pos = dots_pos + 2
<a name="l00359"></a>00359       new_pos = <a class="code" href="../../dd/da8/classpump_1_1Cursor.html">Cursor</a>(pos.line + 1, 0)
<a name="l00360"></a>00360       <span class="keywordflow">yield</span> <a class="code" href="../../df/d92/namespacepump.html#ae95150dec49136d71303f5f4239dd5b6">MakeToken</a>(lines, pos, new_pos, <span class="stringliteral">&#39;exp&#39;</span>)
<a name="l00361"></a>00361       pos = new_pos
<a name="l00362"></a>00362     <span class="keywordflow">elif</span> found.token_type == <span class="stringliteral">&#39;$&#39;</span>:
<a name="l00363"></a>00363       <span class="keywordflow">if</span> prev_token:
<a name="l00364"></a>00364         <span class="keywordflow">yield</span> prev_token
<a name="l00365"></a>00365       <span class="keywordflow">yield</span> found
<a name="l00366"></a>00366       exp_token = <a class="code" href="../../df/d92/namespacepump.html#a44d91c490d21a9119501d099e6caf547">ParseExpTokenInParens</a>(lines, found.end)
<a name="l00367"></a>00367       <span class="keywordflow">yield</span> exp_token
<a name="l00368"></a>00368       pos = exp_token.end
<a name="l00369"></a>00369     <span class="keywordflow">elif</span> (found.token_type == <span class="stringliteral">&#39;]]&#39;</span> <span class="keywordflow">or</span> found.token_type == <span class="stringliteral">&#39;$if&#39;</span> <span class="keywordflow">or</span>
<a name="l00370"></a>00370           found.token_type == <span class="stringliteral">&#39;$elif&#39;</span> <span class="keywordflow">or</span> found.token_type == <span class="stringliteral">&#39;$else&#39;</span>):
<a name="l00371"></a>00371       <span class="keywordflow">if</span> prev_token_rstripped:
<a name="l00372"></a>00372         <span class="keywordflow">yield</span> prev_token_rstripped
<a name="l00373"></a>00373       <span class="keywordflow">yield</span> found
<a name="l00374"></a>00374       pos = found.end
<a name="l00375"></a>00375     <span class="keywordflow">else</span>:
<a name="l00376"></a>00376       <span class="keywordflow">if</span> prev_token:
<a name="l00377"></a>00377         <span class="keywordflow">yield</span> prev_token
<a name="l00378"></a>00378       <span class="keywordflow">yield</span> found
<a name="l00379"></a>00379       pos = found.end
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 
<a name="l00382"></a><a class="code" href="../../df/d92/namespacepump.html#a20d8ba8cc8ad85c10542e430e790e3ff">00382</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a20d8ba8cc8ad85c10542e430e790e3ff">Tokenize</a>(s):
<a name="l00383"></a>00383   <span class="stringliteral">&quot;&quot;&quot;A generator that yields the tokens in the given string.&quot;&quot;&quot;</span>
<a name="l00384"></a>00384   <span class="keywordflow">if</span> s != <span class="stringliteral">&#39;&#39;</span>:
<a name="l00385"></a>00385     lines = s.splitlines(<span class="keyword">True</span>)
<a name="l00386"></a>00386     <span class="keywordflow">for</span> token <span class="keywordflow">in</span> <a class="code" href="../../df/d92/namespacepump.html#abbbf5e37a9a7dda79d6c53a99f373e27">TokenizeLines</a>(lines, <a class="code" href="../../dd/da8/classpump_1_1Cursor.html">Cursor</a>(0, 0)):
<a name="l00387"></a>00387       <span class="keywordflow">yield</span> token
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 
<a name="l00390"></a><a class="code" href="../../d8/d35/classpump_1_1CodeNode.html">00390</a> <span class="keyword">class </span><a class="code" href="../../d8/d35/classpump_1_1CodeNode.html">CodeNode</a>:
<a name="l00391"></a><a class="code" href="../../d8/d35/classpump_1_1CodeNode.html#a37b98239728299970150b73c1a05c287">00391</a>   <span class="keyword">def </span><a class="code" href="../../d8/d35/classpump_1_1CodeNode.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, atomic_code_list=None):
<a name="l00392"></a>00392     self.<a class="code" href="../../d8/d35/classpump_1_1CodeNode.html#a37b98239728299970150b73c1a05c287">atomic_code</a> = atomic_code_list
<a name="l00393"></a>00393 
<a name="l00394"></a>00394 
<a name="l00395"></a><a class="code" href="../../d9/dae/classpump_1_1VarNode.html">00395</a> <span class="keyword">class </span><a class="code" href="../../d9/dae/classpump_1_1VarNode.html">VarNode</a>:
<a name="l00396"></a><a class="code" href="../../d9/dae/classpump_1_1VarNode.html#afc486b0767ef05e2dc12f5b98be72902">00396</a>   <span class="keyword">def </span><a class="code" href="../../d9/dae/classpump_1_1VarNode.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, identifier=None, atomic_code=None):
<a name="l00397"></a>00397     self.<a class="code" href="../../d9/dae/classpump_1_1VarNode.html#afc486b0767ef05e2dc12f5b98be72902">identifier</a> = identifier
<a name="l00398"></a>00398     self.<a class="code" href="../../d9/dae/classpump_1_1VarNode.html#a37b98239728299970150b73c1a05c287">atomic_code</a> = atomic_code
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 
<a name="l00401"></a><a class="code" href="../../de/dc9/classpump_1_1RangeNode.html">00401</a> <span class="keyword">class </span><a class="code" href="../../de/dc9/classpump_1_1RangeNode.html">RangeNode</a>:
<a name="l00402"></a><a class="code" href="../../de/dc9/classpump_1_1RangeNode.html#afc486b0767ef05e2dc12f5b98be72902">00402</a>   <span class="keyword">def </span><a class="code" href="../../de/dc9/classpump_1_1RangeNode.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, identifier=None, exp1=None, exp2=None):
<a name="l00403"></a>00403     self.<a class="code" href="../../de/dc9/classpump_1_1RangeNode.html#afc486b0767ef05e2dc12f5b98be72902">identifier</a> = identifier
<a name="l00404"></a>00404     self.<a class="code" href="../../de/dc9/classpump_1_1RangeNode.html#a2669d6bdd8f8a5feb2a310835a68ee67">exp1</a> = exp1
<a name="l00405"></a>00405     self.<a class="code" href="../../de/dc9/classpump_1_1RangeNode.html#ad4fd52950722eafd3a3994efd6f37edc">exp2</a> = exp2
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 
<a name="l00408"></a><a class="code" href="../../d4/d92/classpump_1_1ForNode.html">00408</a> <span class="keyword">class </span><a class="code" href="../../d4/d92/classpump_1_1ForNode.html">ForNode</a>:
<a name="l00409"></a><a class="code" href="../../d4/d92/classpump_1_1ForNode.html#a46420880a743b84984d25cc134101880">00409</a>   <span class="keyword">def </span><a class="code" href="../../d4/d92/classpump_1_1ForNode.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, identifier=None, sep=None, code=None):
<a name="l00410"></a>00410     self.<a class="code" href="../../d4/d92/classpump_1_1ForNode.html#afc486b0767ef05e2dc12f5b98be72902">identifier</a> = identifier
<a name="l00411"></a>00411     self.<a class="code" href="../../d4/d92/classpump_1_1ForNode.html#a46420880a743b84984d25cc134101880">sep</a> = sep
<a name="l00412"></a>00412     self.<a class="code" href="../../d4/d92/classpump_1_1ForNode.html#afb9ed1b8a27eb20854efe6e23e297683">code</a> = code
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 
<a name="l00415"></a><a class="code" href="../../da/dc2/classpump_1_1ElseNode.html">00415</a> <span class="keyword">class </span><a class="code" href="../../da/dc2/classpump_1_1ElseNode.html">ElseNode</a>:
<a name="l00416"></a><a class="code" href="../../da/dc2/classpump_1_1ElseNode.html#a0a80780690b731c57dfe91bab6338474">00416</a>   <span class="keyword">def </span><a class="code" href="../../da/dc2/classpump_1_1ElseNode.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, else_branch=None):
<a name="l00417"></a>00417     self.<a class="code" href="../../da/dc2/classpump_1_1ElseNode.html#a0a80780690b731c57dfe91bab6338474">else_branch</a> = else_branch
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 
<a name="l00420"></a><a class="code" href="../../d5/d9d/classpump_1_1IfNode.html">00420</a> <span class="keyword">class </span><a class="code" href="../../d5/d9d/classpump_1_1IfNode.html">IfNode</a>:
<a name="l00421"></a><a class="code" href="../../d5/d9d/classpump_1_1IfNode.html#a619fd17feb1e6cf727f79a4c7b6ee936">00421</a>   <span class="keyword">def </span><a class="code" href="../../d5/d9d/classpump_1_1IfNode.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, exp=None, then_branch=None, else_branch=None):
<a name="l00422"></a>00422     self.<a class="code" href="../../d5/d9d/classpump_1_1IfNode.html#a966ec49392882354106741a6a582fec4">exp</a> = exp
<a name="l00423"></a>00423     self.<a class="code" href="../../d5/d9d/classpump_1_1IfNode.html#a619fd17feb1e6cf727f79a4c7b6ee936">then_branch</a> = then_branch
<a name="l00424"></a>00424     self.<a class="code" href="../../d5/d9d/classpump_1_1IfNode.html#a0a80780690b731c57dfe91bab6338474">else_branch</a> = else_branch
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 
<a name="l00427"></a><a class="code" href="../../d3/df6/classpump_1_1RawCodeNode.html">00427</a> <span class="keyword">class </span><a class="code" href="../../d3/df6/classpump_1_1RawCodeNode.html">RawCodeNode</a>:
<a name="l00428"></a><a class="code" href="../../d3/df6/classpump_1_1RawCodeNode.html#a8db72c4ea9ebfb2846099aabd030b415">00428</a>   <span class="keyword">def </span><a class="code" href="../../d3/df6/classpump_1_1RawCodeNode.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, token=None):
<a name="l00429"></a>00429     self.<a class="code" href="../../d3/df6/classpump_1_1RawCodeNode.html#a8db72c4ea9ebfb2846099aabd030b415">raw_code</a> = token
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 
<a name="l00432"></a><a class="code" href="../../d0/d8c/classpump_1_1LiteralDollarNode.html">00432</a> <span class="keyword">class </span><a class="code" href="../../d0/d8c/classpump_1_1LiteralDollarNode.html">LiteralDollarNode</a>:
<a name="l00433"></a><a class="code" href="../../d0/d8c/classpump_1_1LiteralDollarNode.html#a87da3d8264af1c9427605148f20dd9c4">00433</a>   <span class="keyword">def </span><a class="code" href="../../d0/d8c/classpump_1_1LiteralDollarNode.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, token):
<a name="l00434"></a>00434     self.<a class="code" href="../../d0/d8c/classpump_1_1LiteralDollarNode.html#a87da3d8264af1c9427605148f20dd9c4">token</a> = token
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 
<a name="l00437"></a><a class="code" href="../../d1/d6a/classpump_1_1ExpNode.html">00437</a> <span class="keyword">class </span><a class="code" href="../../d1/d6a/classpump_1_1ExpNode.html">ExpNode</a>:
<a name="l00438"></a><a class="code" href="../../d1/d6a/classpump_1_1ExpNode.html#a87da3d8264af1c9427605148f20dd9c4">00438</a>   <span class="keyword">def </span><a class="code" href="../../d1/d6a/classpump_1_1ExpNode.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, token, python_exp):
<a name="l00439"></a>00439     self.<a class="code" href="../../d1/d6a/classpump_1_1ExpNode.html#a87da3d8264af1c9427605148f20dd9c4">token</a> = token
<a name="l00440"></a>00440     self.<a class="code" href="../../d1/d6a/classpump_1_1ExpNode.html#ad0b70a692b34e003d973e22ef80d0e69">python_exp</a> = python_exp
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="../../df/d92/namespacepump.html#abcc5a745b7c32c2f7ad56db0927e7e95">00443</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#abcc5a745b7c32c2f7ad56db0927e7e95">PopFront</a>(a_list):
<a name="l00444"></a>00444   head = a_list[0]
<a name="l00445"></a>00445   a_list[:1] = []
<a name="l00446"></a>00446   <span class="keywordflow">return</span> head
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 
<a name="l00449"></a><a class="code" href="../../df/d92/namespacepump.html#a2564f2b542c763cb63e04b6ebf677ab6">00449</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a2564f2b542c763cb63e04b6ebf677ab6">PushFront</a>(a_list, elem):
<a name="l00450"></a>00450   a_list[:0] = [elem]
<a name="l00451"></a>00451 
<a name="l00452"></a>00452 
<a name="l00453"></a><a class="code" href="../../df/d92/namespacepump.html#a40f31f2cc2901242a70790e6076852c2">00453</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a40f31f2cc2901242a70790e6076852c2">PopToken</a>(a_list, token_type=None):
<a name="l00454"></a>00454   token = <a class="code" href="../../df/d92/namespacepump.html#abcc5a745b7c32c2f7ad56db0927e7e95">PopFront</a>(a_list)
<a name="l00455"></a>00455   <span class="keywordflow">if</span> token_type <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> token.token_type != token_type:
<a name="l00456"></a>00456     <span class="keywordflow">print</span> <span class="stringliteral">&#39;ERROR: %s expected at %s&#39;</span> % (token_type, token.start)
<a name="l00457"></a>00457     <span class="keywordflow">print</span> <span class="stringliteral">&#39;ERROR: %s found instead&#39;</span> % (token,)
<a name="l00458"></a>00458     sys.exit(1)
<a name="l00459"></a>00459 
<a name="l00460"></a>00460   <span class="keywordflow">return</span> token
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 
<a name="l00463"></a><a class="code" href="../../df/d92/namespacepump.html#a31f67c63f8ebc024712e16220432b3ff">00463</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a31f67c63f8ebc024712e16220432b3ff">PeekToken</a>(a_list):
<a name="l00464"></a>00464   <span class="keywordflow">if</span> <span class="keywordflow">not</span> a_list:
<a name="l00465"></a>00465     <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00466"></a>00466 
<a name="l00467"></a>00467   <span class="keywordflow">return</span> a_list[0]
<a name="l00468"></a>00468 
<a name="l00469"></a>00469 
<a name="l00470"></a><a class="code" href="../../df/d92/namespacepump.html#a150cd6bba14352433acc753d4591670e">00470</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a150cd6bba14352433acc753d4591670e">ParseExpNode</a>(token):
<a name="l00471"></a>00471   python_exp = re.sub(<span class="stringliteral">r&#39;([_A-Za-z]\w*)&#39;</span>, <span class="stringliteral">r&#39;self.GetValue(&quot;\1&quot;)&#39;</span>, token.value)
<a name="l00472"></a>00472   <span class="keywordflow">return</span> <a class="code" href="../../d1/d6a/classpump_1_1ExpNode.html">ExpNode</a>(token, python_exp)
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 
<a name="l00475"></a><a class="code" href="../../df/d92/namespacepump.html#a7c097cb9e4096fd75d1fed9d26b87bfd">00475</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a7c097cb9e4096fd75d1fed9d26b87bfd">ParseElseNode</a>(tokens):
<a name="l00476"></a>00476   <span class="keyword">def </span>Pop(token_type=None):
<a name="l00477"></a>00477     <span class="keywordflow">return</span> <a class="code" href="../../df/d92/namespacepump.html#a40f31f2cc2901242a70790e6076852c2">PopToken</a>(tokens, token_type)
<a name="l00478"></a>00478 
<a name="l00479"></a>00479   next = <a class="code" href="../../df/d92/namespacepump.html#a31f67c63f8ebc024712e16220432b3ff">PeekToken</a>(tokens)
<a name="l00480"></a>00480   <span class="keywordflow">if</span> <span class="keywordflow">not</span> next:
<a name="l00481"></a>00481     <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00482"></a>00482   <span class="keywordflow">if</span> next.token_type == <span class="stringliteral">&#39;$else&#39;</span>:
<a name="l00483"></a>00483     Pop(<span class="stringliteral">&#39;$else&#39;</span>)
<a name="l00484"></a>00484     Pop(<span class="stringliteral">&#39;[[&#39;</span>)
<a name="l00485"></a>00485     code_node = <a class="code" href="../../df/d92/namespacepump.html#aa889d697c651115f8eb880d5b9dd7120">ParseCodeNode</a>(tokens)
<a name="l00486"></a>00486     Pop(<span class="stringliteral">&#39;]]&#39;</span>)
<a name="l00487"></a>00487     <span class="keywordflow">return</span> code_node
<a name="l00488"></a>00488   <span class="keywordflow">elif</span> next.token_type == <span class="stringliteral">&#39;$elif&#39;</span>:
<a name="l00489"></a>00489     Pop(<span class="stringliteral">&#39;$elif&#39;</span>)
<a name="l00490"></a>00490     exp = Pop(<span class="stringliteral">&#39;code&#39;</span>)
<a name="l00491"></a>00491     Pop(<span class="stringliteral">&#39;[[&#39;</span>)
<a name="l00492"></a>00492     code_node = <a class="code" href="../../df/d92/namespacepump.html#aa889d697c651115f8eb880d5b9dd7120">ParseCodeNode</a>(tokens)
<a name="l00493"></a>00493     Pop(<span class="stringliteral">&#39;]]&#39;</span>)
<a name="l00494"></a>00494     inner_else_node = <a class="code" href="../../df/d92/namespacepump.html#a7c097cb9e4096fd75d1fed9d26b87bfd">ParseElseNode</a>(tokens)
<a name="l00495"></a>00495     <span class="keywordflow">return</span> <a class="code" href="../../d8/d35/classpump_1_1CodeNode.html">CodeNode</a>([<a class="code" href="../../d5/d9d/classpump_1_1IfNode.html">IfNode</a>(<a class="code" href="../../df/d92/namespacepump.html#a150cd6bba14352433acc753d4591670e">ParseExpNode</a>(exp), code_node, inner_else_node)])
<a name="l00496"></a>00496   <span class="keywordflow">elif</span> <span class="keywordflow">not</span> next.value.strip():
<a name="l00497"></a>00497     Pop(<span class="stringliteral">&#39;code&#39;</span>)
<a name="l00498"></a>00498     <span class="keywordflow">return</span> <a class="code" href="../../df/d92/namespacepump.html#a7c097cb9e4096fd75d1fed9d26b87bfd">ParseElseNode</a>(tokens)
<a name="l00499"></a>00499   <span class="keywordflow">else</span>:
<a name="l00500"></a>00500     <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 
<a name="l00503"></a><a class="code" href="../../df/d92/namespacepump.html#a40224eb47d27ea5626c29081d0d533f2">00503</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a40224eb47d27ea5626c29081d0d533f2">ParseAtomicCodeNode</a>(tokens):
<a name="l00504"></a>00504   <span class="keyword">def </span>Pop(token_type=None):
<a name="l00505"></a>00505     <span class="keywordflow">return</span> <a class="code" href="../../df/d92/namespacepump.html#a40f31f2cc2901242a70790e6076852c2">PopToken</a>(tokens, token_type)
<a name="l00506"></a>00506 
<a name="l00507"></a>00507   head = <a class="code" href="../../df/d92/namespacepump.html#abcc5a745b7c32c2f7ad56db0927e7e95">PopFront</a>(tokens)
<a name="l00508"></a>00508   t = head.token_type
<a name="l00509"></a>00509   <span class="keywordflow">if</span> t == <span class="stringliteral">&#39;code&#39;</span>:
<a name="l00510"></a>00510     <span class="keywordflow">return</span> <a class="code" href="../../d3/df6/classpump_1_1RawCodeNode.html">RawCodeNode</a>(head)
<a name="l00511"></a>00511   <span class="keywordflow">elif</span> t == <span class="stringliteral">&#39;$var&#39;</span>:
<a name="l00512"></a>00512     id_token = Pop(<span class="stringliteral">&#39;id&#39;</span>)
<a name="l00513"></a>00513     Pop(<span class="stringliteral">&#39;=&#39;</span>)
<a name="l00514"></a>00514     next = <a class="code" href="../../df/d92/namespacepump.html#a31f67c63f8ebc024712e16220432b3ff">PeekToken</a>(tokens)
<a name="l00515"></a>00515     <span class="keywordflow">if</span> next.token_type == <span class="stringliteral">&#39;exp&#39;</span>:
<a name="l00516"></a>00516       exp_token = Pop()
<a name="l00517"></a>00517       <span class="keywordflow">return</span> <a class="code" href="../../d9/dae/classpump_1_1VarNode.html">VarNode</a>(id_token, <a class="code" href="../../df/d92/namespacepump.html#a150cd6bba14352433acc753d4591670e">ParseExpNode</a>(exp_token))
<a name="l00518"></a>00518     Pop(<span class="stringliteral">&#39;[[&#39;</span>)
<a name="l00519"></a>00519     code_node = <a class="code" href="../../df/d92/namespacepump.html#aa889d697c651115f8eb880d5b9dd7120">ParseCodeNode</a>(tokens)
<a name="l00520"></a>00520     Pop(<span class="stringliteral">&#39;]]&#39;</span>)
<a name="l00521"></a>00521     <span class="keywordflow">return</span> <a class="code" href="../../d9/dae/classpump_1_1VarNode.html">VarNode</a>(id_token, code_node)
<a name="l00522"></a>00522   <span class="keywordflow">elif</span> t == <span class="stringliteral">&#39;$for&#39;</span>:
<a name="l00523"></a>00523     id_token = Pop(<span class="stringliteral">&#39;id&#39;</span>)
<a name="l00524"></a>00524     next_token = <a class="code" href="../../df/d92/namespacepump.html#a31f67c63f8ebc024712e16220432b3ff">PeekToken</a>(tokens)
<a name="l00525"></a>00525     <span class="keywordflow">if</span> next_token.token_type == <span class="stringliteral">&#39;code&#39;</span>:
<a name="l00526"></a>00526       sep_token = next_token
<a name="l00527"></a>00527       Pop(<span class="stringliteral">&#39;code&#39;</span>)
<a name="l00528"></a>00528     <span class="keywordflow">else</span>:
<a name="l00529"></a>00529       sep_token = <span class="keywordtype">None</span>
<a name="l00530"></a>00530     Pop(<span class="stringliteral">&#39;[[&#39;</span>)
<a name="l00531"></a>00531     code_node = <a class="code" href="../../df/d92/namespacepump.html#aa889d697c651115f8eb880d5b9dd7120">ParseCodeNode</a>(tokens)
<a name="l00532"></a>00532     Pop(<span class="stringliteral">&#39;]]&#39;</span>)
<a name="l00533"></a>00533     <span class="keywordflow">return</span> <a class="code" href="../../d4/d92/classpump_1_1ForNode.html">ForNode</a>(id_token, sep_token, code_node)
<a name="l00534"></a>00534   <span class="keywordflow">elif</span> t == <span class="stringliteral">&#39;$if&#39;</span>:
<a name="l00535"></a>00535     exp_token = Pop(<span class="stringliteral">&#39;code&#39;</span>)
<a name="l00536"></a>00536     Pop(<span class="stringliteral">&#39;[[&#39;</span>)
<a name="l00537"></a>00537     code_node = <a class="code" href="../../df/d92/namespacepump.html#aa889d697c651115f8eb880d5b9dd7120">ParseCodeNode</a>(tokens)
<a name="l00538"></a>00538     Pop(<span class="stringliteral">&#39;]]&#39;</span>)
<a name="l00539"></a>00539     else_node = <a class="code" href="../../df/d92/namespacepump.html#a7c097cb9e4096fd75d1fed9d26b87bfd">ParseElseNode</a>(tokens)
<a name="l00540"></a>00540     <span class="keywordflow">return</span> <a class="code" href="../../d5/d9d/classpump_1_1IfNode.html">IfNode</a>(<a class="code" href="../../df/d92/namespacepump.html#a150cd6bba14352433acc753d4591670e">ParseExpNode</a>(exp_token), code_node, else_node)
<a name="l00541"></a>00541   <span class="keywordflow">elif</span> t == <span class="stringliteral">&#39;$range&#39;</span>:
<a name="l00542"></a>00542     id_token = Pop(<span class="stringliteral">&#39;id&#39;</span>)
<a name="l00543"></a>00543     exp1_token = Pop(<span class="stringliteral">&#39;exp&#39;</span>)
<a name="l00544"></a>00544     Pop(<span class="stringliteral">&#39;..&#39;</span>)
<a name="l00545"></a>00545     exp2_token = Pop(<span class="stringliteral">&#39;exp&#39;</span>)
<a name="l00546"></a>00546     <span class="keywordflow">return</span> <a class="code" href="../../de/dc9/classpump_1_1RangeNode.html">RangeNode</a>(id_token, <a class="code" href="../../df/d92/namespacepump.html#a150cd6bba14352433acc753d4591670e">ParseExpNode</a>(exp1_token),
<a name="l00547"></a>00547                      <a class="code" href="../../df/d92/namespacepump.html#a150cd6bba14352433acc753d4591670e">ParseExpNode</a>(exp2_token))
<a name="l00548"></a>00548   <span class="keywordflow">elif</span> t == <span class="stringliteral">&#39;$id&#39;</span>:
<a name="l00549"></a>00549     <span class="keywordflow">return</span> <a class="code" href="../../df/d92/namespacepump.html#a150cd6bba14352433acc753d4591670e">ParseExpNode</a>(<a class="code" href="../../d2/ddc/classpump_1_1Token.html">Token</a>(head.start + 1, head.end, head.value[1:], <span class="stringliteral">&#39;id&#39;</span>))
<a name="l00550"></a>00550   <span class="keywordflow">elif</span> t == <span class="stringliteral">&#39;$($)&#39;</span>:
<a name="l00551"></a>00551     <span class="keywordflow">return</span> <a class="code" href="../../d0/d8c/classpump_1_1LiteralDollarNode.html">LiteralDollarNode</a>(head)
<a name="l00552"></a>00552   <span class="keywordflow">elif</span> t == <span class="stringliteral">&#39;$&#39;</span>:
<a name="l00553"></a>00553     exp_token = Pop(<span class="stringliteral">&#39;exp&#39;</span>)
<a name="l00554"></a>00554     <span class="keywordflow">return</span> <a class="code" href="../../df/d92/namespacepump.html#a150cd6bba14352433acc753d4591670e">ParseExpNode</a>(exp_token)
<a name="l00555"></a>00555   <span class="keywordflow">elif</span> t == <span class="stringliteral">&#39;[[&#39;</span>:
<a name="l00556"></a>00556     code_node = <a class="code" href="../../df/d92/namespacepump.html#aa889d697c651115f8eb880d5b9dd7120">ParseCodeNode</a>(tokens)
<a name="l00557"></a>00557     Pop(<span class="stringliteral">&#39;]]&#39;</span>)
<a name="l00558"></a>00558     <span class="keywordflow">return</span> code_node
<a name="l00559"></a>00559   <span class="keywordflow">else</span>:
<a name="l00560"></a>00560     <a class="code" href="../../df/d92/namespacepump.html#a2564f2b542c763cb63e04b6ebf677ab6">PushFront</a>(tokens, head)
<a name="l00561"></a>00561     <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 
<a name="l00564"></a><a class="code" href="../../df/d92/namespacepump.html#aa889d697c651115f8eb880d5b9dd7120">00564</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#aa889d697c651115f8eb880d5b9dd7120">ParseCodeNode</a>(tokens):
<a name="l00565"></a>00565   atomic_code_list = []
<a name="l00566"></a>00566   <span class="keywordflow">while</span> <span class="keyword">True</span>:
<a name="l00567"></a>00567     <span class="keywordflow">if</span> <span class="keywordflow">not</span> tokens:
<a name="l00568"></a>00568       <span class="keywordflow">break</span>
<a name="l00569"></a>00569     atomic_code_node = <a class="code" href="../../df/d92/namespacepump.html#a40224eb47d27ea5626c29081d0d533f2">ParseAtomicCodeNode</a>(tokens)
<a name="l00570"></a>00570     <span class="keywordflow">if</span> atomic_code_node:
<a name="l00571"></a>00571       atomic_code_list.append(atomic_code_node)
<a name="l00572"></a>00572     <span class="keywordflow">else</span>:
<a name="l00573"></a>00573       <span class="keywordflow">break</span>
<a name="l00574"></a>00574   <span class="keywordflow">return</span> <a class="code" href="../../d8/d35/classpump_1_1CodeNode.html">CodeNode</a>(atomic_code_list)
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 
<a name="l00577"></a><a class="code" href="../../df/d92/namespacepump.html#a2bb33f428498bc39017e60acc4a28593">00577</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a2bb33f428498bc39017e60acc4a28593">ParseToAST</a>(pump_src_text):
<a name="l00578"></a>00578   <span class="stringliteral">&quot;&quot;&quot;Convert the given Pump source text into an AST.&quot;&quot;&quot;</span>
<a name="l00579"></a>00579   tokens = list(<a class="code" href="../../df/d92/namespacepump.html#a20d8ba8cc8ad85c10542e430e790e3ff">Tokenize</a>(pump_src_text))
<a name="l00580"></a>00580   code_node = <a class="code" href="../../df/d92/namespacepump.html#aa889d697c651115f8eb880d5b9dd7120">ParseCodeNode</a>(tokens)
<a name="l00581"></a>00581   <span class="keywordflow">return</span> code_node
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 
<a name="l00584"></a><a class="code" href="../../da/da8/classpump_1_1Env.html">00584</a> <span class="keyword">class </span><a class="code" href="../../da/da8/classpump_1_1Env.html">Env</a>:
<a name="l00585"></a><a class="code" href="../../da/da8/classpump_1_1Env.html#a626e63c7be6e71872233832cce1dccc0">00585</a>   <span class="keyword">def </span><a class="code" href="../../da/da8/classpump_1_1Env.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self):
<a name="l00586"></a>00586     self.<a class="code" href="../../da/da8/classpump_1_1Env.html#a626e63c7be6e71872233832cce1dccc0">variables</a> = []
<a name="l00587"></a>00587     self.<a class="code" href="../../da/da8/classpump_1_1Env.html#ad11a1805dd4f6710e9566106c6f795f2">ranges</a> = []
<a name="l00588"></a>00588 
<a name="l00589"></a><a class="code" href="../../da/da8/classpump_1_1Env.html#aff981755ef197de06774d0c1cf6cceb9">00589</a>   <span class="keyword">def </span><a class="code" href="../../da/da8/classpump_1_1Env.html#aff981755ef197de06774d0c1cf6cceb9">Clone</a>(self):
<a name="l00590"></a>00590     clone = <a class="code" href="../../da/da8/classpump_1_1Env.html">Env</a>()
<a name="l00591"></a>00591     clone.variables = self.<a class="code" href="../../da/da8/classpump_1_1Env.html#a626e63c7be6e71872233832cce1dccc0">variables</a>[:]
<a name="l00592"></a>00592     clone.ranges = self.<a class="code" href="../../da/da8/classpump_1_1Env.html#ad11a1805dd4f6710e9566106c6f795f2">ranges</a>[:]
<a name="l00593"></a>00593     <span class="keywordflow">return</span> clone
<a name="l00594"></a>00594 
<a name="l00595"></a><a class="code" href="../../da/da8/classpump_1_1Env.html#ad15bfa5e02880960d286a9e65baa9970">00595</a>   <span class="keyword">def </span><a class="code" href="../../da/da8/classpump_1_1Env.html#ad15bfa5e02880960d286a9e65baa9970">PushVariable</a>(self, var, value):
<a name="l00596"></a>00596     <span class="comment"># If value looks like an int, store it as an int.</span>
<a name="l00597"></a>00597     <span class="keywordflow">try</span>:
<a name="l00598"></a>00598       int_value = int(value)
<a name="l00599"></a>00599       <span class="keywordflow">if</span> (<span class="stringliteral">&#39;%s&#39;</span> % int_value) == value:
<a name="l00600"></a>00600         value = int_value
<a name="l00601"></a>00601     <span class="keywordflow">except</span> Exception:
<a name="l00602"></a>00602       <span class="keywordflow">pass</span>
<a name="l00603"></a>00603     self.<a class="code" href="../../da/da8/classpump_1_1Env.html#a626e63c7be6e71872233832cce1dccc0">variables</a>[:0] = [(var, value)]
<a name="l00604"></a>00604 
<a name="l00605"></a><a class="code" href="../../da/da8/classpump_1_1Env.html#a0737f9f157a0f0be4afd96e6dc3ac593">00605</a>   <span class="keyword">def </span><a class="code" href="../../da/da8/classpump_1_1Env.html#a0737f9f157a0f0be4afd96e6dc3ac593">PopVariable</a>(self):
<a name="l00606"></a>00606     self.<a class="code" href="../../da/da8/classpump_1_1Env.html#a626e63c7be6e71872233832cce1dccc0">variables</a>[:1] = []
<a name="l00607"></a>00607 
<a name="l00608"></a><a class="code" href="../../da/da8/classpump_1_1Env.html#af7e99fe7b9308e38d5b9ca4a8db4d56b">00608</a>   <span class="keyword">def </span><a class="code" href="../../da/da8/classpump_1_1Env.html#af7e99fe7b9308e38d5b9ca4a8db4d56b">PushRange</a>(self, var, lower, upper):
<a name="l00609"></a>00609     self.<a class="code" href="../../da/da8/classpump_1_1Env.html#ad11a1805dd4f6710e9566106c6f795f2">ranges</a>[:0] = [(var, lower, upper)]
<a name="l00610"></a>00610 
<a name="l00611"></a><a class="code" href="../../da/da8/classpump_1_1Env.html#a3e7851a1a19d0482235a323e97dce8ff">00611</a>   <span class="keyword">def </span><a class="code" href="../../da/da8/classpump_1_1Env.html#a3e7851a1a19d0482235a323e97dce8ff">PopRange</a>(self):
<a name="l00612"></a>00612     self.<a class="code" href="../../da/da8/classpump_1_1Env.html#ad11a1805dd4f6710e9566106c6f795f2">ranges</a>[:1] = []
<a name="l00613"></a>00613 
<a name="l00614"></a><a class="code" href="../../da/da8/classpump_1_1Env.html#a6ad5f2dce23561603333027d43b0cc2e">00614</a>   <span class="keyword">def </span><a class="code" href="../../da/da8/classpump_1_1Env.html#a6ad5f2dce23561603333027d43b0cc2e">GetValue</a>(self, identifier):
<a name="l00615"></a>00615     <span class="keywordflow">for</span> (var, value) <span class="keywordflow">in</span> self.<a class="code" href="../../da/da8/classpump_1_1Env.html#a626e63c7be6e71872233832cce1dccc0">variables</a>:
<a name="l00616"></a>00616       <span class="keywordflow">if</span> identifier == var:
<a name="l00617"></a>00617         <span class="keywordflow">return</span> value
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     <span class="keywordflow">print</span> <span class="stringliteral">&#39;ERROR: meta variable %s is undefined.&#39;</span> % (identifier,)
<a name="l00620"></a>00620     sys.exit(1)
<a name="l00621"></a>00621 
<a name="l00622"></a><a class="code" href="../../da/da8/classpump_1_1Env.html#a015f55a8b9d3a8c6694baa05d0970b33">00622</a>   <span class="keyword">def </span><a class="code" href="../../da/da8/classpump_1_1Env.html#a015f55a8b9d3a8c6694baa05d0970b33">EvalExp</a>(self, exp):
<a name="l00623"></a>00623     <span class="keywordflow">try</span>:
<a name="l00624"></a>00624       result = eval(exp.python_exp)
<a name="l00625"></a>00625     <span class="keywordflow">except</span> Exception, e:
<a name="l00626"></a>00626       <span class="keywordflow">print</span> <span class="stringliteral">&#39;ERROR: caught exception %s: %s&#39;</span> % (e.__class__.__name__, e)
<a name="l00627"></a>00627       <span class="keywordflow">print</span> (<span class="stringliteral">&#39;ERROR: failed to evaluate meta expression %s at %s&#39;</span> %
<a name="l00628"></a>00628              (exp.python_exp, exp.token.start))
<a name="l00629"></a>00629       sys.exit(1)
<a name="l00630"></a>00630     <span class="keywordflow">return</span> result
<a name="l00631"></a>00631 
<a name="l00632"></a><a class="code" href="../../da/da8/classpump_1_1Env.html#a7689fcbdac40eafa498ffca7cbe2bf7d">00632</a>   <span class="keyword">def </span><a class="code" href="../../da/da8/classpump_1_1Env.html#a7689fcbdac40eafa498ffca7cbe2bf7d">GetRange</a>(self, identifier):
<a name="l00633"></a>00633     <span class="keywordflow">for</span> (var, lower, upper) <span class="keywordflow">in</span> self.<a class="code" href="../../da/da8/classpump_1_1Env.html#ad11a1805dd4f6710e9566106c6f795f2">ranges</a>:
<a name="l00634"></a>00634       <span class="keywordflow">if</span> identifier == var:
<a name="l00635"></a>00635         <span class="keywordflow">return</span> (lower, upper)
<a name="l00636"></a>00636 
<a name="l00637"></a>00637     <span class="keywordflow">print</span> <span class="stringliteral">&#39;ERROR: range %s is undefined.&#39;</span> % (identifier,)
<a name="l00638"></a>00638     sys.exit(1)
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 
<a name="l00641"></a><a class="code" href="../../d7/d0c/classpump_1_1Output.html">00641</a> <span class="keyword">class </span><a class="code" href="../../d7/d0c/classpump_1_1Output.html">Output</a>:
<a name="l00642"></a><a class="code" href="../../d7/d0c/classpump_1_1Output.html#a338951b7e7607b65262fb051e7804d91">00642</a>   <span class="keyword">def </span><a class="code" href="../../d7/d0c/classpump_1_1Output.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self):
<a name="l00643"></a>00643     self.<a class="code" href="../../d7/d0c/classpump_1_1Output.html#a338951b7e7607b65262fb051e7804d91">string</a> = <span class="stringliteral">&#39;&#39;</span>
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="../../d7/d0c/classpump_1_1Output.html#a776673d5e749b2ea87aa856b41a0b070">00645</a>   <span class="keyword">def </span><a class="code" href="../../d7/d0c/classpump_1_1Output.html#a776673d5e749b2ea87aa856b41a0b070">GetLastLine</a>(self):
<a name="l00646"></a>00646     index = self.string.rfind(<span class="stringliteral">&#39;\n&#39;</span>)
<a name="l00647"></a>00647     <span class="keywordflow">if</span> index &lt; 0:
<a name="l00648"></a>00648       <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <span class="keywordflow">return</span> self.<a class="code" href="../../d7/d0c/classpump_1_1Output.html#a338951b7e7607b65262fb051e7804d91">string</a>[index + 1:]
<a name="l00651"></a>00651 
<a name="l00652"></a><a class="code" href="../../d7/d0c/classpump_1_1Output.html#ad562afdeaee2b695fc856e826250babf">00652</a>   <span class="keyword">def </span><a class="code" href="../../d7/d0c/classpump_1_1Output.html#ad562afdeaee2b695fc856e826250babf">Append</a>(self, s):
<a name="l00653"></a>00653     self.<a class="code" href="../../d7/d0c/classpump_1_1Output.html#a338951b7e7607b65262fb051e7804d91">string</a> += s
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 
<a name="l00656"></a><a class="code" href="../../df/d92/namespacepump.html#af8495f590c6140bb8fe23807f7d0f09e">00656</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#af8495f590c6140bb8fe23807f7d0f09e">RunAtomicCode</a>(env, node, output):
<a name="l00657"></a>00657   <span class="keywordflow">if</span> isinstance(node, VarNode):
<a name="l00658"></a>00658     identifier = node.identifier.value.strip()
<a name="l00659"></a>00659     result = <a class="code" href="../../d7/d0c/classpump_1_1Output.html">Output</a>()
<a name="l00660"></a>00660     <a class="code" href="../../df/d92/namespacepump.html#af8495f590c6140bb8fe23807f7d0f09e">RunAtomicCode</a>(env.Clone(), node.atomic_code, result)
<a name="l00661"></a>00661     value = result.string
<a name="l00662"></a>00662     env.PushVariable(identifier, value)
<a name="l00663"></a>00663   <span class="keywordflow">elif</span> isinstance(node, RangeNode):
<a name="l00664"></a>00664     identifier = node.identifier.value.strip()
<a name="l00665"></a>00665     lower = int(env.EvalExp(node.exp1))
<a name="l00666"></a>00666     upper = int(env.EvalExp(node.exp2))
<a name="l00667"></a>00667     env.PushRange(identifier, lower, upper)
<a name="l00668"></a>00668   <span class="keywordflow">elif</span> isinstance(node, ForNode):
<a name="l00669"></a>00669     identifier = node.identifier.value.strip()
<a name="l00670"></a>00670     <span class="keywordflow">if</span> node.sep <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00671"></a>00671       sep = <span class="stringliteral">&#39;&#39;</span>
<a name="l00672"></a>00672     <span class="keywordflow">else</span>:
<a name="l00673"></a>00673       sep = node.sep.value
<a name="l00674"></a>00674     (lower, upper) = env.GetRange(identifier)
<a name="l00675"></a>00675     <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(lower, upper + 1):
<a name="l00676"></a>00676       new_env = env.Clone()
<a name="l00677"></a>00677       new_env.PushVariable(identifier, i)
<a name="l00678"></a>00678       <a class="code" href="../../df/d92/namespacepump.html#ac1cc678dd90b4e98e9e6757c2d8ed99a">RunCode</a>(new_env, node.code, output)
<a name="l00679"></a>00679       <span class="keywordflow">if</span> i != upper:
<a name="l00680"></a>00680         output.Append(sep)
<a name="l00681"></a>00681   <span class="keywordflow">elif</span> isinstance(node, RawCodeNode):
<a name="l00682"></a>00682     output.Append(node.raw_code.value)
<a name="l00683"></a>00683   <span class="keywordflow">elif</span> isinstance(node, IfNode):
<a name="l00684"></a>00684     cond = env.EvalExp(node.exp)
<a name="l00685"></a>00685     <span class="keywordflow">if</span> cond:
<a name="l00686"></a>00686       <a class="code" href="../../df/d92/namespacepump.html#ac1cc678dd90b4e98e9e6757c2d8ed99a">RunCode</a>(env.Clone(), node.then_branch, output)
<a name="l00687"></a>00687     <span class="keywordflow">elif</span> node.else_branch <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00688"></a>00688       <a class="code" href="../../df/d92/namespacepump.html#ac1cc678dd90b4e98e9e6757c2d8ed99a">RunCode</a>(env.Clone(), node.else_branch, output)
<a name="l00689"></a>00689   <span class="keywordflow">elif</span> isinstance(node, ExpNode):
<a name="l00690"></a>00690     value = env.EvalExp(node)
<a name="l00691"></a>00691     output.Append(<span class="stringliteral">&#39;%s&#39;</span> % (value,))
<a name="l00692"></a>00692   <span class="keywordflow">elif</span> isinstance(node, LiteralDollarNode):
<a name="l00693"></a>00693     output.Append(<span class="stringliteral">&#39;$&#39;</span>)
<a name="l00694"></a>00694   <span class="keywordflow">elif</span> isinstance(node, CodeNode):
<a name="l00695"></a>00695     <a class="code" href="../../df/d92/namespacepump.html#ac1cc678dd90b4e98e9e6757c2d8ed99a">RunCode</a>(env.Clone(), node, output)
<a name="l00696"></a>00696   <span class="keywordflow">else</span>:
<a name="l00697"></a>00697     <span class="keywordflow">print</span> <span class="stringliteral">&#39;BAD&#39;</span>
<a name="l00698"></a>00698     <span class="keywordflow">print</span> node
<a name="l00699"></a>00699     sys.exit(1)
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 
<a name="l00702"></a><a class="code" href="../../df/d92/namespacepump.html#ac1cc678dd90b4e98e9e6757c2d8ed99a">00702</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#ac1cc678dd90b4e98e9e6757c2d8ed99a">RunCode</a>(env, code_node, output):
<a name="l00703"></a>00703   <span class="keywordflow">for</span> atomic_code <span class="keywordflow">in</span> code_node.atomic_code:
<a name="l00704"></a>00704     <a class="code" href="../../df/d92/namespacepump.html#af8495f590c6140bb8fe23807f7d0f09e">RunAtomicCode</a>(env, atomic_code, output)
<a name="l00705"></a>00705 
<a name="l00706"></a>00706 
<a name="l00707"></a><a class="code" href="../../df/d92/namespacepump.html#ad622ff337885deef7970ed22908fb182">00707</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#ad622ff337885deef7970ed22908fb182">IsComment</a>(cur_line):
<a name="l00708"></a>00708   <span class="keywordflow">return</span> <span class="stringliteral">&#39;//&#39;</span> <span class="keywordflow">in</span> cur_line
<a name="l00709"></a>00709 
<a name="l00710"></a>00710 
<a name="l00711"></a><a class="code" href="../../df/d92/namespacepump.html#a101c9171c77f8491faf600af4b48e516">00711</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a101c9171c77f8491faf600af4b48e516">IsInPreprocessorDirevative</a>(prev_lines, cur_line):
<a name="l00712"></a>00712   <span class="keywordflow">if</span> cur_line.lstrip().startswith(<span class="stringliteral">&#39;#&#39;</span>):
<a name="l00713"></a>00713     <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l00714"></a>00714   <span class="keywordflow">return</span> prev_lines != [] <span class="keywordflow">and</span> prev_lines[-1].endswith(<span class="stringliteral">&#39;\\&#39;</span>)
<a name="l00715"></a>00715 
<a name="l00716"></a>00716 
<a name="l00717"></a><a class="code" href="../../df/d92/namespacepump.html#a8677a2e43df12f97c0264c11484c93ad">00717</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a8677a2e43df12f97c0264c11484c93ad">WrapComment</a>(line, output):
<a name="l00718"></a>00718   loc = line.find(<span class="stringliteral">&#39;//&#39;</span>)
<a name="l00719"></a>00719   before_comment = line[:loc].rstrip()
<a name="l00720"></a>00720   <span class="keywordflow">if</span> before_comment == <span class="stringliteral">&#39;&#39;</span>:
<a name="l00721"></a>00721     indent = loc
<a name="l00722"></a>00722   <span class="keywordflow">else</span>:
<a name="l00723"></a>00723     output.append(before_comment)
<a name="l00724"></a>00724     indent = len(before_comment) - len(before_comment.lstrip())
<a name="l00725"></a>00725   prefix = indent*<span class="stringliteral">&#39; &#39;</span> + <span class="stringliteral">&#39;// &#39;</span>
<a name="l00726"></a>00726   max_len = 80 - len(prefix)
<a name="l00727"></a>00727   comment = line[loc + 2:].strip()
<a name="l00728"></a>00728   segs = [seg <span class="keywordflow">for</span> seg <span class="keywordflow">in</span> re.split(<span class="stringliteral">r&#39;(\w+\W*)&#39;</span>, comment) <span class="keywordflow">if</span> seg != <span class="stringliteral">&#39;&#39;</span>]
<a name="l00729"></a>00729   cur_line = <span class="stringliteral">&#39;&#39;</span>
<a name="l00730"></a>00730   <span class="keywordflow">for</span> seg <span class="keywordflow">in</span> segs:
<a name="l00731"></a>00731     <span class="keywordflow">if</span> len((cur_line + seg).rstrip()) &lt; max_len:
<a name="l00732"></a>00732       cur_line += seg
<a name="l00733"></a>00733     <span class="keywordflow">else</span>:
<a name="l00734"></a>00734       <span class="keywordflow">if</span> cur_line.strip() != <span class="stringliteral">&#39;&#39;</span>:
<a name="l00735"></a>00735         output.append(prefix + cur_line.rstrip())
<a name="l00736"></a>00736       cur_line = seg.lstrip()
<a name="l00737"></a>00737   <span class="keywordflow">if</span> cur_line.strip() != <span class="stringliteral">&#39;&#39;</span>:
<a name="l00738"></a>00738     output.append(prefix + cur_line.strip())
<a name="l00739"></a>00739 
<a name="l00740"></a>00740 
<a name="l00741"></a><a class="code" href="../../df/d92/namespacepump.html#a47b13e91e95ce5ad82778b919b51dc0b">00741</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a47b13e91e95ce5ad82778b919b51dc0b">WrapCode</a>(line, line_concat, output):
<a name="l00742"></a>00742   indent = len(line) - len(line.lstrip())
<a name="l00743"></a>00743   prefix = indent*<span class="stringliteral">&#39; &#39;</span>  <span class="comment"># Prefix of the current line</span>
<a name="l00744"></a>00744   max_len = 80 - indent - len(line_concat)  <span class="comment"># Maximum length of the current line</span>
<a name="l00745"></a>00745   new_prefix = prefix + 4*<span class="stringliteral">&#39; &#39;</span>  <span class="comment"># Prefix of a continuation line</span>
<a name="l00746"></a>00746   new_max_len = max_len - 4  <span class="comment"># Maximum length of a continuation line</span>
<a name="l00747"></a>00747   <span class="comment"># Prefers to wrap a line after a &#39;,&#39; or &#39;;&#39;.</span>
<a name="l00748"></a>00748   segs = [seg <span class="keywordflow">for</span> seg <span class="keywordflow">in</span> re.split(<span class="stringliteral">r&#39;([^,;]+[,;]?)&#39;</span>, line.strip()) <span class="keywordflow">if</span> seg != <span class="stringliteral">&#39;&#39;</span>]
<a name="l00749"></a>00749   cur_line = <span class="stringliteral">&#39;&#39;</span>  <span class="comment"># The current line without leading spaces.</span>
<a name="l00750"></a>00750   <span class="keywordflow">for</span> seg <span class="keywordflow">in</span> segs:
<a name="l00751"></a>00751     <span class="comment"># If the line is still too long, wrap at a space.</span>
<a name="l00752"></a>00752     <span class="keywordflow">while</span> cur_line == <span class="stringliteral">&#39;&#39;</span> <span class="keywordflow">and</span> len(seg.strip()) &gt; max_len:
<a name="l00753"></a>00753       seg = seg.lstrip()
<a name="l00754"></a>00754       split_at = seg.rfind(<span class="stringliteral">&#39; &#39;</span>, 0, max_len)
<a name="l00755"></a>00755       output.append(prefix + seg[:split_at].strip() + line_concat)
<a name="l00756"></a>00756       seg = seg[split_at + 1:]
<a name="l00757"></a>00757       prefix = new_prefix
<a name="l00758"></a>00758       max_len = new_max_len
<a name="l00759"></a>00759 
<a name="l00760"></a>00760     <span class="keywordflow">if</span> len((cur_line + seg).rstrip()) &lt; max_len:
<a name="l00761"></a>00761       cur_line = (cur_line + seg).lstrip()
<a name="l00762"></a>00762     <span class="keywordflow">else</span>:
<a name="l00763"></a>00763       output.append(prefix + cur_line.rstrip() + line_concat)
<a name="l00764"></a>00764       prefix = new_prefix
<a name="l00765"></a>00765       max_len = new_max_len
<a name="l00766"></a>00766       cur_line = seg.lstrip()
<a name="l00767"></a>00767   <span class="keywordflow">if</span> cur_line.strip() != <span class="stringliteral">&#39;&#39;</span>:
<a name="l00768"></a>00768     output.append(prefix + cur_line.strip())
<a name="l00769"></a>00769 
<a name="l00770"></a>00770 
<a name="l00771"></a><a class="code" href="../../df/d92/namespacepump.html#ab79a373a6832251df2a3a0de88c2bb67">00771</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#ab79a373a6832251df2a3a0de88c2bb67">WrapPreprocessorDirevative</a>(line, output):
<a name="l00772"></a>00772   <a class="code" href="../../df/d92/namespacepump.html#a47b13e91e95ce5ad82778b919b51dc0b">WrapCode</a>(line, <span class="stringliteral">&#39; \\&#39;</span>, output)
<a name="l00773"></a>00773 
<a name="l00774"></a>00774 
<a name="l00775"></a><a class="code" href="../../df/d92/namespacepump.html#aa10f49653a1076dd726c717e6498e38c">00775</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#aa10f49653a1076dd726c717e6498e38c">WrapPlainCode</a>(line, output):
<a name="l00776"></a>00776   <a class="code" href="../../df/d92/namespacepump.html#a47b13e91e95ce5ad82778b919b51dc0b">WrapCode</a>(line, <span class="stringliteral">&#39;&#39;</span>, output)
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 
<a name="l00779"></a><a class="code" href="../../df/d92/namespacepump.html#a2dbcc069f95fcebc2fe98e237075d8af">00779</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a2dbcc069f95fcebc2fe98e237075d8af">IsHeaderGuardOrInclude</a>(line):
<a name="l00780"></a>00780   <span class="keywordflow">return</span> (re.match(<span class="stringliteral">r&#39;^#(ifndef|define|endif\s*//)\s*[\w_]+\s*$&#39;</span>, line) <span class="keywordflow">or</span>
<a name="l00781"></a>00781           re.match(<span class="stringliteral">r&#39;^#include\s&#39;</span>, line))
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 
<a name="l00784"></a><a class="code" href="../../df/d92/namespacepump.html#addffcaf4dbb430aaeb7193cca96c0422">00784</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#addffcaf4dbb430aaeb7193cca96c0422">WrapLongLine</a>(line, output):
<a name="l00785"></a>00785   line = line.rstrip()
<a name="l00786"></a>00786   <span class="keywordflow">if</span> len(line) &lt;= 80:
<a name="l00787"></a>00787     output.append(line)
<a name="l00788"></a>00788   <span class="keywordflow">elif</span> <a class="code" href="../../df/d92/namespacepump.html#ad622ff337885deef7970ed22908fb182">IsComment</a>(line):
<a name="l00789"></a>00789     <span class="keywordflow">if</span> <a class="code" href="../../df/d92/namespacepump.html#a2dbcc069f95fcebc2fe98e237075d8af">IsHeaderGuardOrInclude</a>(line):
<a name="l00790"></a>00790       <span class="comment"># The style guide made an exception to allow long header guard lines</span>
<a name="l00791"></a>00791       <span class="comment"># and includes.</span>
<a name="l00792"></a>00792       output.append(line)
<a name="l00793"></a>00793     <span class="keywordflow">else</span>:
<a name="l00794"></a>00794       <a class="code" href="../../df/d92/namespacepump.html#a8677a2e43df12f97c0264c11484c93ad">WrapComment</a>(line, output)
<a name="l00795"></a>00795   <span class="keywordflow">elif</span> <a class="code" href="../../df/d92/namespacepump.html#a101c9171c77f8491faf600af4b48e516">IsInPreprocessorDirevative</a>(output, line):
<a name="l00796"></a>00796     <span class="keywordflow">if</span> <a class="code" href="../../df/d92/namespacepump.html#a2dbcc069f95fcebc2fe98e237075d8af">IsHeaderGuardOrInclude</a>(line):
<a name="l00797"></a>00797       <span class="comment"># The style guide made an exception to allow long header guard lines</span>
<a name="l00798"></a>00798       <span class="comment"># and includes.</span>
<a name="l00799"></a>00799       output.append(line)
<a name="l00800"></a>00800     <span class="keywordflow">else</span>:
<a name="l00801"></a>00801       <a class="code" href="../../df/d92/namespacepump.html#ab79a373a6832251df2a3a0de88c2bb67">WrapPreprocessorDirevative</a>(line, output)
<a name="l00802"></a>00802   <span class="keywordflow">else</span>:
<a name="l00803"></a>00803     <a class="code" href="../../df/d92/namespacepump.html#aa10f49653a1076dd726c717e6498e38c">WrapPlainCode</a>(line, output)
<a name="l00804"></a>00804 
<a name="l00805"></a>00805 
<a name="l00806"></a><a class="code" href="../../df/d92/namespacepump.html#a57fae516f7cf25ad72a7074e2b0c9d3c">00806</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a57fae516f7cf25ad72a7074e2b0c9d3c">BeautifyCode</a>(string):
<a name="l00807"></a>00807   lines = string.splitlines()
<a name="l00808"></a>00808   output = []
<a name="l00809"></a>00809   <span class="keywordflow">for</span> line <span class="keywordflow">in</span> lines:
<a name="l00810"></a>00810     <a class="code" href="../../df/d92/namespacepump.html#addffcaf4dbb430aaeb7193cca96c0422">WrapLongLine</a>(line, output)
<a name="l00811"></a>00811   output2 = [line.rstrip() <span class="keywordflow">for</span> line <span class="keywordflow">in</span> output]
<a name="l00812"></a>00812   <span class="keywordflow">return</span> <span class="stringliteral">&#39;\n&#39;</span>.join(output2) + <span class="stringliteral">&#39;\n&#39;</span>
<a name="l00813"></a>00813 
<a name="l00814"></a>00814 
<a name="l00815"></a><a class="code" href="../../df/d92/namespacepump.html#ae4a7ae18fdc10f1460aace6726295f36">00815</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#ae4a7ae18fdc10f1460aace6726295f36">ConvertFromPumpSource</a>(src_text):
<a name="l00816"></a>00816   <span class="stringliteral">&quot;&quot;&quot;Return the text generated from the given Pump source text.&quot;&quot;&quot;</span>
<a name="l00817"></a>00817   ast = <a class="code" href="../../df/d92/namespacepump.html#a2bb33f428498bc39017e60acc4a28593">ParseToAST</a>(<a class="code" href="../../df/d92/namespacepump.html#a23b6bb138dc055b93b9d13d0b092a725">StripMetaComments</a>(src_text))
<a name="l00818"></a>00818   output = <a class="code" href="../../d7/d0c/classpump_1_1Output.html">Output</a>()
<a name="l00819"></a>00819   <a class="code" href="../../df/d92/namespacepump.html#ac1cc678dd90b4e98e9e6757c2d8ed99a">RunCode</a>(<a class="code" href="../../da/da8/classpump_1_1Env.html">Env</a>(), ast, output)
<a name="l00820"></a>00820   <span class="keywordflow">return</span> <a class="code" href="../../df/d92/namespacepump.html#a57fae516f7cf25ad72a7074e2b0c9d3c">BeautifyCode</a>(output.string)
<a name="l00821"></a>00821 
<a name="l00822"></a>00822 
<a name="l00823"></a><a class="code" href="../../df/d92/namespacepump.html#a7b440d502623497b7d8cfcbb03a7f8c5">00823</a> <span class="keyword">def </span><a class="code" href="../../df/d92/namespacepump.html#a7b440d502623497b7d8cfcbb03a7f8c5">main</a>(argv):
<a name="l00824"></a>00824   <span class="keywordflow">if</span> len(argv) == 1:
<a name="l00825"></a>00825     <span class="keywordflow">print</span> __doc__
<a name="l00826"></a>00826     sys.exit(1)
<a name="l00827"></a>00827 
<a name="l00828"></a>00828   file_path = argv[-1]
<a name="l00829"></a>00829   output_str = <a class="code" href="../../df/d92/namespacepump.html#ae4a7ae18fdc10f1460aace6726295f36">ConvertFromPumpSource</a>(file(file_path, <span class="stringliteral">&#39;</span><span class="stringliteral">r&#39;).read())</span>
<a name="l00830"></a>00830 <span class="stringliteral">  </span><span class="keywordflow">if</span> file_path.endswith(<span class="stringliteral">&#39;.pump&#39;</span>):
<a name="l00831"></a>00831     output_file_path = file_path[:-5]
<a name="l00832"></a>00832   <span class="keywordflow">else</span>:
<a name="l00833"></a>00833     output_file_path = <span class="stringliteral">&#39;-&#39;</span>
<a name="l00834"></a>00834   <span class="keywordflow">if</span> output_file_path == <span class="stringliteral">&#39;-&#39;</span>:
<a name="l00835"></a>00835     <span class="keywordflow">print</span> output_str,
<a name="l00836"></a>00836   <span class="keywordflow">else</span>:
<a name="l00837"></a>00837     output_file = file(output_file_path, <span class="stringliteral">&#39;w&#39;</span>)
<a name="l00838"></a>00838     output_file.write(<span class="stringliteral">&#39;// This file was GENERATED by command:\n&#39;</span>)
<a name="l00839"></a>00839     output_file.write(<span class="stringliteral">&#39;//     %s %s\n&#39;</span> %
<a name="l00840"></a>00840                       (os.path.basename(__file__), os.path.basename(file_path)))
<a name="l00841"></a>00841     output_file.write(<span class="stringliteral">&#39;// DO NOT EDIT BY HAND!!!\n\n&#39;</span>)
<a name="l00842"></a>00842     output_file.write(output_str)
<a name="l00843"></a>00843     output_file.close()
<a name="l00844"></a>00844 
<a name="l00845"></a>00845 
<a name="l00846"></a>00846 <span class="keywordflow">if</span> __name__ == <span class="stringliteral">&#39;__main__&#39;</span>:
<a name="l00847"></a>00847   <a class="code" href="../../df/d92/namespacepump.html#a7b440d502623497b7d8cfcbb03a7f8c5">main</a>(sys.argv)
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="../../dc/ded/pump_8py.html">pump.py</a>      </li>

    <li class="footer">Generated on Sun Aug 19 2012 21:32:25 for yuh library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>

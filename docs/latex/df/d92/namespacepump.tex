\hypertarget{namespacepump}{\section{pump \-Namespace \-Reference}
\label{df/d92/namespacepump}\index{pump@{pump}}
}
\subsection*{\-Classes}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classpump_1_1Cursor}{\-Cursor}
\item 
class \hyperlink{classpump_1_1Token}{\-Token}
\item 
class \hyperlink{classpump_1_1CodeNode}{\-Code\-Node}
\item 
class \hyperlink{classpump_1_1VarNode}{\-Var\-Node}
\item 
class \hyperlink{classpump_1_1RangeNode}{\-Range\-Node}
\item 
class \hyperlink{classpump_1_1ForNode}{\-For\-Node}
\item 
class \hyperlink{classpump_1_1ElseNode}{\-Else\-Node}
\item 
class \hyperlink{classpump_1_1IfNode}{\-If\-Node}
\item 
class \hyperlink{classpump_1_1RawCodeNode}{\-Raw\-Code\-Node}
\item 
class \hyperlink{classpump_1_1LiteralDollarNode}{\-Literal\-Dollar\-Node}
\item 
class \hyperlink{classpump_1_1ExpNode}{\-Exp\-Node}
\item 
class \hyperlink{classpump_1_1Env}{\-Env}
\item 
class \hyperlink{classpump_1_1Output}{\-Output}
\end{DoxyCompactItemize}
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{namespacepump_ace406cec139528a5aa1640edf8dbebe6}{\-Eof}
\item 
def \hyperlink{namespacepump_a291b93315bfdd697deaee88680502c00}{\-Starts\-With}
\item 
def \hyperlink{namespacepump_acca697b3cc5adc6044b115e9e16c019e}{\-Find\-First\-In\-Line}
\item 
def \hyperlink{namespacepump_a9713ad82d1c87f60ad986c6ce96f0002}{\-Find\-First}
\item 
def \hyperlink{namespacepump_a0d1ed8e160c333130bd8f84c8fe457e5}{\-Sub\-String}
\item 
def \hyperlink{namespacepump_a23b6bb138dc055b93b9d13d0b092a725}{\-Strip\-Meta\-Comments}
\item 
def \hyperlink{namespacepump_ae95150dec49136d71303f5f4239dd5b6}{\-Make\-Token}
\item 
def \hyperlink{namespacepump_a85396ae3b56877c067788f45b163eff5}{\-Parse\-Token}
\item 
def \hyperlink{namespacepump_a2a4a78c5cca4b815e2f323eba9245dd4}{\-Skip}
\item 
def \hyperlink{namespacepump_a14ce849109475f0297844fb68697f5ef}{\-Skip\-Until}
\item 
def \hyperlink{namespacepump_a44d91c490d21a9119501d099e6caf547}{\-Parse\-Exp\-Token\-In\-Parens}
\item 
def \hyperlink{namespacepump_ad52cab2935ab52c2ff26aac5196a1ace}{\-R\-Strip\-New\-Line\-From\-Token}
\item 
def \hyperlink{namespacepump_abbbf5e37a9a7dda79d6c53a99f373e27}{\-Tokenize\-Lines}
\item 
def \hyperlink{namespacepump_a20d8ba8cc8ad85c10542e430e790e3ff}{\-Tokenize}
\item 
def \hyperlink{namespacepump_abcc5a745b7c32c2f7ad56db0927e7e95}{\-Pop\-Front}
\item 
def \hyperlink{namespacepump_a2564f2b542c763cb63e04b6ebf677ab6}{\-Push\-Front}
\item 
def \hyperlink{namespacepump_a40f31f2cc2901242a70790e6076852c2}{\-Pop\-Token}
\item 
def \hyperlink{namespacepump_a31f67c63f8ebc024712e16220432b3ff}{\-Peek\-Token}
\item 
def \hyperlink{namespacepump_a150cd6bba14352433acc753d4591670e}{\-Parse\-Exp\-Node}
\item 
def \hyperlink{namespacepump_a7c097cb9e4096fd75d1fed9d26b87bfd}{\-Parse\-Else\-Node}
\item 
def \hyperlink{namespacepump_a40224eb47d27ea5626c29081d0d533f2}{\-Parse\-Atomic\-Code\-Node}
\item 
def \hyperlink{namespacepump_aa889d697c651115f8eb880d5b9dd7120}{\-Parse\-Code\-Node}
\item 
def \hyperlink{namespacepump_a2bb33f428498bc39017e60acc4a28593}{\-Parse\-To\-A\-S\-T}
\item 
def \hyperlink{namespacepump_af8495f590c6140bb8fe23807f7d0f09e}{\-Run\-Atomic\-Code}
\item 
def \hyperlink{namespacepump_ac1cc678dd90b4e98e9e6757c2d8ed99a}{\-Run\-Code}
\item 
def \hyperlink{namespacepump_ad622ff337885deef7970ed22908fb182}{\-Is\-Comment}
\item 
def \hyperlink{namespacepump_a101c9171c77f8491faf600af4b48e516}{\-Is\-In\-Preprocessor\-Direvative}
\item 
def \hyperlink{namespacepump_a8677a2e43df12f97c0264c11484c93ad}{\-Wrap\-Comment}
\item 
def \hyperlink{namespacepump_a47b13e91e95ce5ad82778b919b51dc0b}{\-Wrap\-Code}
\item 
def \hyperlink{namespacepump_ab79a373a6832251df2a3a0de88c2bb67}{\-Wrap\-Preprocessor\-Direvative}
\item 
def \hyperlink{namespacepump_aa10f49653a1076dd726c717e6498e38c}{\-Wrap\-Plain\-Code}
\item 
def \hyperlink{namespacepump_a2dbcc069f95fcebc2fe98e237075d8af}{\-Is\-Header\-Guard\-Or\-Include}
\item 
def \hyperlink{namespacepump_addffcaf4dbb430aaeb7193cca96c0422}{\-Wrap\-Long\-Line}
\item 
def \hyperlink{namespacepump_a57fae516f7cf25ad72a7074e2b0c9d3c}{\-Beautify\-Code}
\item 
def \hyperlink{namespacepump_ae4a7ae18fdc10f1460aace6726295f36}{\-Convert\-From\-Pump\-Source}
\item 
def \hyperlink{namespacepump_a7b440d502623497b7d8cfcbb03a7f8c5}{main}
\end{DoxyCompactItemize}
\subsection*{\-Variables}
\begin{DoxyCompactItemize}
\item 
string \hyperlink{namespacepump_a629d61dfe4da763164a4d1a2d85b0afd}{\-\_\-\-\_\-author\-\_\-\-\_\-} = 'wan@google.\-com (\-Zhanyong \-Wan)'
\item 
list \hyperlink{namespacepump_a6bd373dabbdfeaf3ec7a5e80d5bba44f}{\-T\-O\-K\-E\-N\-\_\-\-T\-A\-B\-L\-E}
\item 
tuple \hyperlink{namespacepump_a72ec68ae8b1a6794caed2e023ad35d0d}{\-I\-D\-\_\-\-R\-E\-G\-E\-X} = re.\-compile(r'\mbox{[}\-\_\-\-A-\/\-Za-\/z\mbox{]}$\backslash$w$\ast$')
\item 
tuple \hyperlink{namespacepump_a89c455f059588c995485f69128edcb04}{\-E\-Q\-\_\-\-R\-E\-G\-E\-X} = re.\-compile(r'=')
\item 
tuple \hyperlink{namespacepump_a3a8b691d5bf29c19ae673e3f3b8aeb03}{\-R\-E\-S\-T\-\_\-\-O\-F\-\_\-\-L\-I\-N\-E\-\_\-\-R\-E\-G\-E\-X} = re.\-compile(r'.$\ast$?(?=\$$|$$\backslash$\$$\backslash$\$)')
\item 
tuple \hyperlink{namespacepump_a72547bba10d6b0d28381a17d46fcddff}{\-O\-P\-T\-I\-O\-N\-A\-L\-\_\-\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-S\-\_\-\-R\-E\-G\-E\-X} = re.\-compile(r'$\backslash$s$\ast$')
\item 
tuple \hyperlink{namespacepump_afdbcc81876235b538ea355fcd2193bbd}{\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-\_\-\-R\-E\-G\-E\-X} = re.\-compile(r'$\backslash$s')
\item 
tuple \hyperlink{namespacepump_a5267421d4c85117b52d918accf1b2cbe}{\-D\-O\-T\-\_\-\-D\-O\-T\-\_\-\-R\-E\-G\-E\-X} = re.\-compile(r'$\backslash$.$\backslash$.')
\end{DoxyCompactItemize}


\subsection{\-Function \-Documentation}
\hypertarget{namespacepump_a57fae516f7cf25ad72a7074e2b0c9d3c}{\index{pump@{pump}!\-Beautify\-Code@{\-Beautify\-Code}}
\index{\-Beautify\-Code@{\-Beautify\-Code}!pump@{pump}}
\subsubsection[{\-Beautify\-Code}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Beautify\-Code} (
\begin{DoxyParamCaption}
\item[{}]{string}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a57fae516f7cf25ad72a7074e2b0c9d3c}


\-Definition at line 806 of file pump.\-py.


\begin{DoxyCode}
806 
807 def BeautifyCode(string):
808   lines = string.splitlines()
809   output = []
810   for line in lines:
811     WrapLongLine(line, output)
812   output2 = [line.rstrip() for line in output]
813   return '\n'.join(output2) + '\n'
814 

\end{DoxyCode}
\hypertarget{namespacepump_ae4a7ae18fdc10f1460aace6726295f36}{\index{pump@{pump}!\-Convert\-From\-Pump\-Source@{\-Convert\-From\-Pump\-Source}}
\index{\-Convert\-From\-Pump\-Source@{\-Convert\-From\-Pump\-Source}!pump@{pump}}
\subsubsection[{\-Convert\-From\-Pump\-Source}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Convert\-From\-Pump\-Source} (
\begin{DoxyParamCaption}
\item[{}]{src\-\_\-text}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_ae4a7ae18fdc10f1460aace6726295f36}
\begin{DoxyVerb}Return the text generated from the given Pump source text.\end{DoxyVerb}
 

\-Definition at line 815 of file pump.\-py.


\begin{DoxyCode}
815 
816 def ConvertFromPumpSource(src_text):
817   """Return the text generated from the given Pump source text."""
818   ast = ParseToAST(StripMetaComments(src_text))
819   output = Output()
820   RunCode(Env(), ast, output)
821   return BeautifyCode(output.string)
822 

\end{DoxyCode}
\hypertarget{namespacepump_ace406cec139528a5aa1640edf8dbebe6}{\index{pump@{pump}!\-Eof@{\-Eof}}
\index{\-Eof@{\-Eof}!pump@{pump}}
\subsubsection[{\-Eof}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Eof} (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_ace406cec139528a5aa1640edf8dbebe6}
\begin{DoxyVerb}Returns the special cursor to denote the end-of-file.\end{DoxyVerb}
 

\-Definition at line 132 of file pump.\-py.


\begin{DoxyCode}
132 
133 def Eof():
134   """Returns the special cursor to denote the end-of-file."""
135   return Cursor(-1, -1)
136 

\end{DoxyCode}
\hypertarget{namespacepump_a9713ad82d1c87f60ad986c6ce96f0002}{\index{pump@{pump}!\-Find\-First@{\-Find\-First}}
\index{\-Find\-First@{\-Find\-First}!pump@{pump}}
\subsubsection[{\-Find\-First}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Find\-First} (
\begin{DoxyParamCaption}
\item[{}]{lines, }
\item[{}]{token\-\_\-table, }
\item[{}]{cursor}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a9713ad82d1c87f60ad986c6ce96f0002}
\begin{DoxyVerb}Finds the first occurrence of any string in strings in lines.\end{DoxyVerb}
 

\-Definition at line 186 of file pump.\-py.


\begin{DoxyCode}
186 
187 def FindFirst(lines, token_table, cursor):
188   """Finds the first occurrence of any string in strings in lines."""
189 
190   start = cursor.Clone()
191   cur_line_number = cursor.line
192   for line in lines[start.line:]:
193     if cur_line_number == start.line:
194       line = line[start.column:]
195     m = FindFirstInLine(line, token_table)
196     if m:
197       # We found a regex in line.
198       (start_column, length, token_type) = m
199       if cur_line_number == start.line:
200         start_column += start.column
201       found_start = Cursor(cur_line_number, start_column)
202       found_end = found_start + length
203       return MakeToken(lines, found_start, found_end, token_type)
204     cur_line_number += 1
205   # We failed to find str in lines
206   return None
207 

\end{DoxyCode}
\hypertarget{namespacepump_acca697b3cc5adc6044b115e9e16c019e}{\index{pump@{pump}!\-Find\-First\-In\-Line@{\-Find\-First\-In\-Line}}
\index{\-Find\-First\-In\-Line@{\-Find\-First\-In\-Line}!pump@{pump}}
\subsubsection[{\-Find\-First\-In\-Line}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Find\-First\-In\-Line} (
\begin{DoxyParamCaption}
\item[{}]{line, }
\item[{}]{token\-\_\-table}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_acca697b3cc5adc6044b115e9e16c019e}


\-Definition at line 169 of file pump.\-py.


\begin{DoxyCode}
169 
170 def FindFirstInLine(line, token_table):
171   best_match_start = -1
172   for (regex, token_type) in token_table:
173     m = regex.search(line)
174     if m:
175       # We found regex in lines
176       if best_match_start < 0 or m.start() < best_match_start:
177         best_match_start = m.start()
178         best_match_length = m.end() - m.start()
179         best_match_token_type = token_type
180 
181   if best_match_start < 0:
182     return None
183 
184   return (best_match_start, best_match_length, best_match_token_type)
185 

\end{DoxyCode}
\hypertarget{namespacepump_ad622ff337885deef7970ed22908fb182}{\index{pump@{pump}!\-Is\-Comment@{\-Is\-Comment}}
\index{\-Is\-Comment@{\-Is\-Comment}!pump@{pump}}
\subsubsection[{\-Is\-Comment}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Is\-Comment} (
\begin{DoxyParamCaption}
\item[{}]{cur\-\_\-line}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_ad622ff337885deef7970ed22908fb182}


\-Definition at line 707 of file pump.\-py.


\begin{DoxyCode}
707 
708 def IsComment(cur_line):
709   return '//' in cur_line
710 

\end{DoxyCode}
\hypertarget{namespacepump_a2dbcc069f95fcebc2fe98e237075d8af}{\index{pump@{pump}!\-Is\-Header\-Guard\-Or\-Include@{\-Is\-Header\-Guard\-Or\-Include}}
\index{\-Is\-Header\-Guard\-Or\-Include@{\-Is\-Header\-Guard\-Or\-Include}!pump@{pump}}
\subsubsection[{\-Is\-Header\-Guard\-Or\-Include}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Is\-Header\-Guard\-Or\-Include} (
\begin{DoxyParamCaption}
\item[{}]{line}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a2dbcc069f95fcebc2fe98e237075d8af}


\-Definition at line 779 of file pump.\-py.


\begin{DoxyCode}
779 
780 def IsHeaderGuardOrInclude(line):
781   return (re.match(r'^#(ifndef|define|endif\s*//)\s*[\w_]+\s*$', line) or
782           re.match(r'^#include\s', line))
783 

\end{DoxyCode}
\hypertarget{namespacepump_a101c9171c77f8491faf600af4b48e516}{\index{pump@{pump}!\-Is\-In\-Preprocessor\-Direvative@{\-Is\-In\-Preprocessor\-Direvative}}
\index{\-Is\-In\-Preprocessor\-Direvative@{\-Is\-In\-Preprocessor\-Direvative}!pump@{pump}}
\subsubsection[{\-Is\-In\-Preprocessor\-Direvative}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Is\-In\-Preprocessor\-Direvative} (
\begin{DoxyParamCaption}
\item[{}]{prev\-\_\-lines, }
\item[{}]{cur\-\_\-line}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a101c9171c77f8491faf600af4b48e516}


\-Definition at line 711 of file pump.\-py.


\begin{DoxyCode}
711 
712 def IsInPreprocessorDirevative(prev_lines, cur_line):
713   if cur_line.lstrip().startswith('#'):
714     return True
715   return prev_lines != [] and prev_lines[-1].endswith('\\')
716 

\end{DoxyCode}
\hypertarget{namespacepump_a7b440d502623497b7d8cfcbb03a7f8c5}{\index{pump@{pump}!main@{main}}
\index{main@{main}!pump@{pump}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-main} (
\begin{DoxyParamCaption}
\item[{}]{argv}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a7b440d502623497b7d8cfcbb03a7f8c5}


\-Definition at line 823 of file pump.\-py.


\begin{DoxyCode}
823 
824 def main(argv):
825   if len(argv) == 1:
826     print __doc__
827     sys.exit(1)
828 
829   file_path = argv[-1]
830   output_str = ConvertFromPumpSource(file(file_path, 'r').read())
831   if file_path.endswith('.pump'):
832     output_file_path = file_path[:-5]
833   else:
834     output_file_path = '-'
835   if output_file_path == '-':
836     print output_str,
837   else:
838     output_file = file(output_file_path, 'w')
839     output_file.write('// This file was GENERATED by command:\n')
840     output_file.write('//     %s %s\n' %
841                       (os.path.basename(__file__), os.path.basename(file_path))
      )
842     output_file.write('// DO NOT EDIT BY HAND!!!\n\n')
843     output_file.write(output_str)
844     output_file.close()
845 

\end{DoxyCode}
\hypertarget{namespacepump_ae95150dec49136d71303f5f4239dd5b6}{\index{pump@{pump}!\-Make\-Token@{\-Make\-Token}}
\index{\-Make\-Token@{\-Make\-Token}!pump@{pump}}
\subsubsection[{\-Make\-Token}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Make\-Token} (
\begin{DoxyParamCaption}
\item[{}]{lines, }
\item[{}]{start, }
\item[{}]{end, }
\item[{}]{token\-\_\-type}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_ae95150dec49136d71303f5f4239dd5b6}
\begin{DoxyVerb}Creates a new instance of Token.\end{DoxyVerb}
 

\-Definition at line 237 of file pump.\-py.


\begin{DoxyCode}
237 
238 def MakeToken(lines, start, end, token_type):
239   """Creates a new instance of Token."""
240 
241   return Token(start, end, SubString(lines, start, end), token_type)
242 

\end{DoxyCode}
\hypertarget{namespacepump_a40224eb47d27ea5626c29081d0d533f2}{\index{pump@{pump}!\-Parse\-Atomic\-Code\-Node@{\-Parse\-Atomic\-Code\-Node}}
\index{\-Parse\-Atomic\-Code\-Node@{\-Parse\-Atomic\-Code\-Node}!pump@{pump}}
\subsubsection[{\-Parse\-Atomic\-Code\-Node}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Parse\-Atomic\-Code\-Node} (
\begin{DoxyParamCaption}
\item[{}]{tokens}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a40224eb47d27ea5626c29081d0d533f2}


\-Definition at line 503 of file pump.\-py.


\begin{DoxyCode}
503 
504 def ParseAtomicCodeNode(tokens):
505   def Pop(token_type=None):
506     return PopToken(tokens, token_type)
507 
508   head = PopFront(tokens)
509   t = head.token_type
510   if t == 'code':
511     return RawCodeNode(head)
512   elif t == '$var':
513     id_token = Pop('id')
514     Pop('=')
515     next = PeekToken(tokens)
516     if next.token_type == 'exp':
517       exp_token = Pop()
518       return VarNode(id_token, ParseExpNode(exp_token))
519     Pop('[[')
520     code_node = ParseCodeNode(tokens)
521     Pop(']]')
522     return VarNode(id_token, code_node)
523   elif t == '$for':
524     id_token = Pop('id')
525     next_token = PeekToken(tokens)
526     if next_token.token_type == 'code':
527       sep_token = next_token
528       Pop('code')
529     else:
530       sep_token = None
531     Pop('[[')
532     code_node = ParseCodeNode(tokens)
533     Pop(']]')
534     return ForNode(id_token, sep_token, code_node)
535   elif t == '$if':
536     exp_token = Pop('code')
537     Pop('[[')
538     code_node = ParseCodeNode(tokens)
539     Pop(']]')
540     else_node = ParseElseNode(tokens)
541     return IfNode(ParseExpNode(exp_token), code_node, else_node)
542   elif t == '$range':
543     id_token = Pop('id')
544     exp1_token = Pop('exp')
545     Pop('..')
546     exp2_token = Pop('exp')
547     return RangeNode(id_token, ParseExpNode(exp1_token),
548                      ParseExpNode(exp2_token))
549   elif t == '$id':
550     return ParseExpNode(Token(head.start + 1, head.end, head.value[1:], 'id'))
551   elif t == '$($)':
552     return LiteralDollarNode(head)
553   elif t == '$':
554     exp_token = Pop('exp')
555     return ParseExpNode(exp_token)
556   elif t == '[[':
557     code_node = ParseCodeNode(tokens)
558     Pop(']]')
559     return code_node
560   else:
561     PushFront(tokens, head)
562     return None
563 

\end{DoxyCode}
\hypertarget{namespacepump_aa889d697c651115f8eb880d5b9dd7120}{\index{pump@{pump}!\-Parse\-Code\-Node@{\-Parse\-Code\-Node}}
\index{\-Parse\-Code\-Node@{\-Parse\-Code\-Node}!pump@{pump}}
\subsubsection[{\-Parse\-Code\-Node}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Parse\-Code\-Node} (
\begin{DoxyParamCaption}
\item[{}]{tokens}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_aa889d697c651115f8eb880d5b9dd7120}


\-Definition at line 564 of file pump.\-py.


\begin{DoxyCode}
564 
565 def ParseCodeNode(tokens):
566   atomic_code_list = []
567   while True:
568     if not tokens:
569       break
570     atomic_code_node = ParseAtomicCodeNode(tokens)
571     if atomic_code_node:
572       atomic_code_list.append(atomic_code_node)
573     else:
574       break
575   return CodeNode(atomic_code_list)
576 

\end{DoxyCode}
\hypertarget{namespacepump_a7c097cb9e4096fd75d1fed9d26b87bfd}{\index{pump@{pump}!\-Parse\-Else\-Node@{\-Parse\-Else\-Node}}
\index{\-Parse\-Else\-Node@{\-Parse\-Else\-Node}!pump@{pump}}
\subsubsection[{\-Parse\-Else\-Node}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Parse\-Else\-Node} (
\begin{DoxyParamCaption}
\item[{}]{tokens}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a7c097cb9e4096fd75d1fed9d26b87bfd}


\-Definition at line 475 of file pump.\-py.


\begin{DoxyCode}
475 
476 def ParseElseNode(tokens):
477   def Pop(token_type=None):
478     return PopToken(tokens, token_type)
479 
480   next = PeekToken(tokens)
481   if not next:
482     return None
483   if next.token_type == '$else':
484     Pop('$else')
485     Pop('[[')
486     code_node = ParseCodeNode(tokens)
487     Pop(']]')
488     return code_node
489   elif next.token_type == '$elif':
490     Pop('$elif')
491     exp = Pop('code')
492     Pop('[[')
493     code_node = ParseCodeNode(tokens)
494     Pop(']]')
495     inner_else_node = ParseElseNode(tokens)
496     return CodeNode([IfNode(ParseExpNode(exp), code_node, inner_else_node)])
497   elif not next.value.strip():
498     Pop('code')
499     return ParseElseNode(tokens)
500   else:
501     return None
502 

\end{DoxyCode}
\hypertarget{namespacepump_a150cd6bba14352433acc753d4591670e}{\index{pump@{pump}!\-Parse\-Exp\-Node@{\-Parse\-Exp\-Node}}
\index{\-Parse\-Exp\-Node@{\-Parse\-Exp\-Node}!pump@{pump}}
\subsubsection[{\-Parse\-Exp\-Node}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Parse\-Exp\-Node} (
\begin{DoxyParamCaption}
\item[{}]{token}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a150cd6bba14352433acc753d4591670e}


\-Definition at line 470 of file pump.\-py.


\begin{DoxyCode}
470 
471 def ParseExpNode(token):
472   python_exp = re.sub(r'([_A-Za-z]\w*)', r'self.GetValue("\1")', token.value)
473   return ExpNode(token, python_exp)
474 

\end{DoxyCode}
\hypertarget{namespacepump_a44d91c490d21a9119501d099e6caf547}{\index{pump@{pump}!\-Parse\-Exp\-Token\-In\-Parens@{\-Parse\-Exp\-Token\-In\-Parens}}
\index{\-Parse\-Exp\-Token\-In\-Parens@{\-Parse\-Exp\-Token\-In\-Parens}!pump@{pump}}
\subsubsection[{\-Parse\-Exp\-Token\-In\-Parens}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Parse\-Exp\-Token\-In\-Parens} (
\begin{DoxyParamCaption}
\item[{}]{lines, }
\item[{}]{pos}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a44d91c490d21a9119501d099e6caf547}


\-Definition at line 281 of file pump.\-py.


\begin{DoxyCode}
281 
282 def ParseExpTokenInParens(lines, pos):
283   def ParseInParens(pos):
284     pos = Skip(lines, pos, OPTIONAL_WHITE_SPACES_REGEX)
285     pos = Skip(lines, pos, r'\(')
286     pos = Parse(pos)
287     pos = Skip(lines, pos, r'\)')
288     return pos
289 
290   def Parse(pos):
291     pos = SkipUntil(lines, pos, r'\(|\)', ')')
292     if SubString(lines, pos, pos + 1) == '(':
293       pos = Parse(pos + 1)
294       pos = Skip(lines, pos, r'\)')
295       return Parse(pos)
296     else:
297       return pos
298 
299   start = pos.Clone()
300   pos = ParseInParens(pos)
301   return MakeToken(lines, start, pos, 'exp')
302 

\end{DoxyCode}
\hypertarget{namespacepump_a2bb33f428498bc39017e60acc4a28593}{\index{pump@{pump}!\-Parse\-To\-A\-S\-T@{\-Parse\-To\-A\-S\-T}}
\index{\-Parse\-To\-A\-S\-T@{\-Parse\-To\-A\-S\-T}!pump@{pump}}
\subsubsection[{\-Parse\-To\-A\-S\-T}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Parse\-To\-A\-S\-T} (
\begin{DoxyParamCaption}
\item[{}]{pump\-\_\-src\-\_\-text}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a2bb33f428498bc39017e60acc4a28593}
\begin{DoxyVerb}Convert the given Pump source text into an AST.\end{DoxyVerb}
 

\-Definition at line 577 of file pump.\-py.


\begin{DoxyCode}
577 
578 def ParseToAST(pump_src_text):
579   """Convert the given Pump source text into an AST."""
580   tokens = list(Tokenize(pump_src_text))
581   code_node = ParseCodeNode(tokens)
582   return code_node
583 

\end{DoxyCode}
\hypertarget{namespacepump_a85396ae3b56877c067788f45b163eff5}{\index{pump@{pump}!\-Parse\-Token@{\-Parse\-Token}}
\index{\-Parse\-Token@{\-Parse\-Token}!pump@{pump}}
\subsubsection[{\-Parse\-Token}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Parse\-Token} (
\begin{DoxyParamCaption}
\item[{}]{lines, }
\item[{}]{pos, }
\item[{}]{regex, }
\item[{}]{token\-\_\-type}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a85396ae3b56877c067788f45b163eff5}


\-Definition at line 243 of file pump.\-py.


\begin{DoxyCode}
243 
244 def ParseToken(lines, pos, regex, token_type):
245   line = lines[pos.line][pos.column:]
246   m = regex.search(line)
247   if m and not m.start():
248     return MakeToken(lines, pos, pos + m.end(), token_type)
249   else:
250     print 'ERROR: %s expected at %s.' % (token_type, pos)
251     sys.exit(1)
252 

\end{DoxyCode}
\hypertarget{namespacepump_a31f67c63f8ebc024712e16220432b3ff}{\index{pump@{pump}!\-Peek\-Token@{\-Peek\-Token}}
\index{\-Peek\-Token@{\-Peek\-Token}!pump@{pump}}
\subsubsection[{\-Peek\-Token}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Peek\-Token} (
\begin{DoxyParamCaption}
\item[{}]{a\-\_\-list}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a31f67c63f8ebc024712e16220432b3ff}


\-Definition at line 463 of file pump.\-py.


\begin{DoxyCode}
463 
464 def PeekToken(a_list):
465   if not a_list:
466     return None
467 
468   return a_list[0]
469 

\end{DoxyCode}
\hypertarget{namespacepump_abcc5a745b7c32c2f7ad56db0927e7e95}{\index{pump@{pump}!\-Pop\-Front@{\-Pop\-Front}}
\index{\-Pop\-Front@{\-Pop\-Front}!pump@{pump}}
\subsubsection[{\-Pop\-Front}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Pop\-Front} (
\begin{DoxyParamCaption}
\item[{}]{a\-\_\-list}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_abcc5a745b7c32c2f7ad56db0927e7e95}


\-Definition at line 443 of file pump.\-py.


\begin{DoxyCode}
443 
444 def PopFront(a_list):
445   head = a_list[0]
446   a_list[:1] = []
447   return head
448 

\end{DoxyCode}
\hypertarget{namespacepump_a40f31f2cc2901242a70790e6076852c2}{\index{pump@{pump}!\-Pop\-Token@{\-Pop\-Token}}
\index{\-Pop\-Token@{\-Pop\-Token}!pump@{pump}}
\subsubsection[{\-Pop\-Token}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Pop\-Token} (
\begin{DoxyParamCaption}
\item[{}]{a\-\_\-list, }
\item[{}]{token\-\_\-type = {\ttfamily \-None}}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a40f31f2cc2901242a70790e6076852c2}


\-Definition at line 453 of file pump.\-py.


\begin{DoxyCode}
453 
454 def PopToken(a_list, token_type=None):
455   token = PopFront(a_list)
456   if token_type is not None and token.token_type != token_type:
457     print 'ERROR: %s expected at %s' % (token_type, token.start)
458     print 'ERROR: %s found instead' % (token,)
459     sys.exit(1)
460 
461   return token
462 

\end{DoxyCode}
\hypertarget{namespacepump_a2564f2b542c763cb63e04b6ebf677ab6}{\index{pump@{pump}!\-Push\-Front@{\-Push\-Front}}
\index{\-Push\-Front@{\-Push\-Front}!pump@{pump}}
\subsubsection[{\-Push\-Front}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Push\-Front} (
\begin{DoxyParamCaption}
\item[{}]{a\-\_\-list, }
\item[{}]{elem}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a2564f2b542c763cb63e04b6ebf677ab6}


\-Definition at line 449 of file pump.\-py.


\begin{DoxyCode}
449 
450 def PushFront(a_list, elem):
451   a_list[:0] = [elem]
452 

\end{DoxyCode}
\hypertarget{namespacepump_ad52cab2935ab52c2ff26aac5196a1ace}{\index{pump@{pump}!\-R\-Strip\-New\-Line\-From\-Token@{\-R\-Strip\-New\-Line\-From\-Token}}
\index{\-R\-Strip\-New\-Line\-From\-Token@{\-R\-Strip\-New\-Line\-From\-Token}!pump@{pump}}
\subsubsection[{\-R\-Strip\-New\-Line\-From\-Token}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-R\-Strip\-New\-Line\-From\-Token} (
\begin{DoxyParamCaption}
\item[{}]{token}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_ad52cab2935ab52c2ff26aac5196a1ace}


\-Definition at line 303 of file pump.\-py.


\begin{DoxyCode}
303 
304 def RStripNewLineFromToken(token):
305   if token.value.endswith('\n'):
306     return Token(token.start, token.end, token.value[:-1], token.token_type)
307   else:
308     return token
309 

\end{DoxyCode}
\hypertarget{namespacepump_af8495f590c6140bb8fe23807f7d0f09e}{\index{pump@{pump}!\-Run\-Atomic\-Code@{\-Run\-Atomic\-Code}}
\index{\-Run\-Atomic\-Code@{\-Run\-Atomic\-Code}!pump@{pump}}
\subsubsection[{\-Run\-Atomic\-Code}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Run\-Atomic\-Code} (
\begin{DoxyParamCaption}
\item[{}]{env, }
\item[{}]{node, }
\item[{}]{output}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_af8495f590c6140bb8fe23807f7d0f09e}


\-Definition at line 656 of file pump.\-py.


\begin{DoxyCode}
656 
657 def RunAtomicCode(env, node, output):
658   if isinstance(node, VarNode):
659     identifier = node.identifier.value.strip()
660     result = Output()
661     RunAtomicCode(env.Clone(), node.atomic_code, result)
662     value = result.string
663     env.PushVariable(identifier, value)
664   elif isinstance(node, RangeNode):
665     identifier = node.identifier.value.strip()
666     lower = int(env.EvalExp(node.exp1))
667     upper = int(env.EvalExp(node.exp2))
668     env.PushRange(identifier, lower, upper)
669   elif isinstance(node, ForNode):
670     identifier = node.identifier.value.strip()
671     if node.sep is None:
672       sep = ''
673     else:
674       sep = node.sep.value
675     (lower, upper) = env.GetRange(identifier)
676     for i in range(lower, upper + 1):
677       new_env = env.Clone()
678       new_env.PushVariable(identifier, i)
679       RunCode(new_env, node.code, output)
680       if i != upper:
681         output.Append(sep)
682   elif isinstance(node, RawCodeNode):
683     output.Append(node.raw_code.value)
684   elif isinstance(node, IfNode):
685     cond = env.EvalExp(node.exp)
686     if cond:
687       RunCode(env.Clone(), node.then_branch, output)
688     elif node.else_branch is not None:
689       RunCode(env.Clone(), node.else_branch, output)
690   elif isinstance(node, ExpNode):
691     value = env.EvalExp(node)
692     output.Append('%s' % (value,))
693   elif isinstance(node, LiteralDollarNode):
694     output.Append('$')
695   elif isinstance(node, CodeNode):
696     RunCode(env.Clone(), node, output)
697   else:
698     print 'BAD'
699     print node
700     sys.exit(1)
701 

\end{DoxyCode}
\hypertarget{namespacepump_ac1cc678dd90b4e98e9e6757c2d8ed99a}{\index{pump@{pump}!\-Run\-Code@{\-Run\-Code}}
\index{\-Run\-Code@{\-Run\-Code}!pump@{pump}}
\subsubsection[{\-Run\-Code}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Run\-Code} (
\begin{DoxyParamCaption}
\item[{}]{env, }
\item[{}]{code\-\_\-node, }
\item[{}]{output}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_ac1cc678dd90b4e98e9e6757c2d8ed99a}


\-Definition at line 702 of file pump.\-py.


\begin{DoxyCode}
702 
703 def RunCode(env, code_node, output):
704   for atomic_code in code_node.atomic_code:
705     RunAtomicCode(env, atomic_code, output)
706 

\end{DoxyCode}
\hypertarget{namespacepump_a2a4a78c5cca4b815e2f323eba9245dd4}{\index{pump@{pump}!\-Skip@{\-Skip}}
\index{\-Skip@{\-Skip}!pump@{pump}}
\subsubsection[{\-Skip}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Skip} (
\begin{DoxyParamCaption}
\item[{}]{lines, }
\item[{}]{pos, }
\item[{}]{regex}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a2a4a78c5cca4b815e2f323eba9245dd4}


\-Definition at line 261 of file pump.\-py.


\begin{DoxyCode}
261 
262 def Skip(lines, pos, regex):
263   line = lines[pos.line][pos.column:]
264   m = re.search(regex, line)
265   if m and not m.start():
266     return pos + m.end()
267   else:
268     return pos
269 

\end{DoxyCode}
\hypertarget{namespacepump_a14ce849109475f0297844fb68697f5ef}{\index{pump@{pump}!\-Skip\-Until@{\-Skip\-Until}}
\index{\-Skip\-Until@{\-Skip\-Until}!pump@{pump}}
\subsubsection[{\-Skip\-Until}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Skip\-Until} (
\begin{DoxyParamCaption}
\item[{}]{lines, }
\item[{}]{pos, }
\item[{}]{regex, }
\item[{}]{token\-\_\-type}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a14ce849109475f0297844fb68697f5ef}


\-Definition at line 270 of file pump.\-py.


\begin{DoxyCode}
270 
271 def SkipUntil(lines, pos, regex, token_type):
272   line = lines[pos.line][pos.column:]
273   m = re.search(regex, line)
274   if m:
275     return pos + m.start()
276   else:
277     print ('ERROR: %s expected on line %s after column %s.' %
278            (token_type, pos.line + 1, pos.column))
279     sys.exit(1)
280 

\end{DoxyCode}
\hypertarget{namespacepump_a291b93315bfdd697deaee88680502c00}{\index{pump@{pump}!\-Starts\-With@{\-Starts\-With}}
\index{\-Starts\-With@{\-Starts\-With}!pump@{pump}}
\subsubsection[{\-Starts\-With}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Starts\-With} (
\begin{DoxyParamCaption}
\item[{}]{lines, }
\item[{}]{pos, }
\item[{}]{string}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a291b93315bfdd697deaee88680502c00}
\begin{DoxyVerb}Returns True iff the given position in lines starts with 'string'.\end{DoxyVerb}
 

\-Definition at line 163 of file pump.\-py.


\begin{DoxyCode}
163 
164 def StartsWith(lines, pos, string):
165   """Returns True iff the given position in lines starts with 'string'."""
166 
167   return lines[pos.line][pos.column:].startswith(string)
168 

\end{DoxyCode}
\hypertarget{namespacepump_a23b6bb138dc055b93b9d13d0b092a725}{\index{pump@{pump}!\-Strip\-Meta\-Comments@{\-Strip\-Meta\-Comments}}
\index{\-Strip\-Meta\-Comments@{\-Strip\-Meta\-Comments}!pump@{pump}}
\subsubsection[{\-Strip\-Meta\-Comments}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Strip\-Meta\-Comments} (
\begin{DoxyParamCaption}
\item[{}]{str}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a23b6bb138dc055b93b9d13d0b092a725}
\begin{DoxyVerb}Strip meta comments from each line in the given string.\end{DoxyVerb}
 

\-Definition at line 226 of file pump.\-py.


\begin{DoxyCode}
226 
227 def StripMetaComments(str):
228   """Strip meta comments from each line in the given string."""
229 
230   # First, completely remove lines containing nothing but a meta
231   # comment, including the trailing \n.
232   str = re.sub(r'^\s*\$\$.*\n', '', str)
233 
234   # Then, remove meta comments from contentful lines.
235   return re.sub(r'\s*\$\$.*', '', str)
236 

\end{DoxyCode}
\hypertarget{namespacepump_a0d1ed8e160c333130bd8f84c8fe457e5}{\index{pump@{pump}!\-Sub\-String@{\-Sub\-String}}
\index{\-Sub\-String@{\-Sub\-String}!pump@{pump}}
\subsubsection[{\-Sub\-String}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Sub\-String} (
\begin{DoxyParamCaption}
\item[{}]{lines, }
\item[{}]{start, }
\item[{}]{end}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a0d1ed8e160c333130bd8f84c8fe457e5}
\begin{DoxyVerb}Returns a substring in lines.\end{DoxyVerb}
 

\-Definition at line 208 of file pump.\-py.


\begin{DoxyCode}
208 
209 def SubString(lines, start, end):
210   """Returns a substring in lines."""
211 
212   if end == Eof():
213     end = Cursor(len(lines) - 1, len(lines[-1]))
214 
215   if start >= end:
216     return ''
217 
218   if start.line == end.line:
219     return lines[start.line][start.column:end.column]
220 
221   result_lines = ([lines[start.line][start.column:]] +
222                   lines[start.line + 1:end.line] +
223                   [lines[end.line][:end.column]])
224   return ''.join(result_lines)
225 

\end{DoxyCode}
\hypertarget{namespacepump_a20d8ba8cc8ad85c10542e430e790e3ff}{\index{pump@{pump}!\-Tokenize@{\-Tokenize}}
\index{\-Tokenize@{\-Tokenize}!pump@{pump}}
\subsubsection[{\-Tokenize}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Tokenize} (
\begin{DoxyParamCaption}
\item[{}]{s}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a20d8ba8cc8ad85c10542e430e790e3ff}
\begin{DoxyVerb}A generator that yields the tokens in the given string.\end{DoxyVerb}
 

\-Definition at line 382 of file pump.\-py.


\begin{DoxyCode}
382 
383 def Tokenize(s):
384   """A generator that yields the tokens in the given string."""
385   if s != '':
386     lines = s.splitlines(True)
387     for token in TokenizeLines(lines, Cursor(0, 0)):
388       yield token
389 

\end{DoxyCode}
\hypertarget{namespacepump_abbbf5e37a9a7dda79d6c53a99f373e27}{\index{pump@{pump}!\-Tokenize\-Lines@{\-Tokenize\-Lines}}
\index{\-Tokenize\-Lines@{\-Tokenize\-Lines}!pump@{pump}}
\subsubsection[{\-Tokenize\-Lines}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Tokenize\-Lines} (
\begin{DoxyParamCaption}
\item[{}]{lines, }
\item[{}]{pos}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_abbbf5e37a9a7dda79d6c53a99f373e27}


\-Definition at line 310 of file pump.\-py.


\begin{DoxyCode}
310 
311 def TokenizeLines(lines, pos):
312   while True:
313     found = FindFirst(lines, TOKEN_TABLE, pos)
314     if not found:
315       yield MakeToken(lines, pos, Eof(), 'code')
316       return
317 
318     if found.start == pos:
319       prev_token = None
320       prev_token_rstripped = None
321     else:
322       prev_token = MakeToken(lines, pos, found.start, 'code')
323       prev_token_rstripped = RStripNewLineFromToken(prev_token)
324 
325     if found.token_type == '$var':
326       if prev_token_rstripped:
327         yield prev_token_rstripped
328       yield found
329       id_token = ParseToken(lines, found.end, ID_REGEX, 'id')
330       yield id_token
331       pos = Skip(lines, id_token.end, OPTIONAL_WHITE_SPACES_REGEX)
332 
333       eq_token = ParseToken(lines, pos, EQ_REGEX, '=')
334       yield eq_token
335       pos = Skip(lines, eq_token.end, r'\s*')
336 
337       if SubString(lines, pos, pos + 2) != '[[':
338         exp_token = ParseToken(lines, pos, REST_OF_LINE_REGEX, 'exp')
339         yield exp_token
340         pos = Cursor(exp_token.end.line + 1, 0)
341     elif found.token_type == '$for':
342       if prev_token_rstripped:
343         yield prev_token_rstripped
344       yield found
345       id_token = ParseToken(lines, found.end, ID_REGEX, 'id')
346       yield id_token
347       pos = Skip(lines, id_token.end, WHITE_SPACE_REGEX)
348     elif found.token_type == '$range':
349       if prev_token_rstripped:
350         yield prev_token_rstripped
351       yield found
352       id_token = ParseToken(lines, found.end, ID_REGEX, 'id')
353       yield id_token
354       pos = Skip(lines, id_token.end, OPTIONAL_WHITE_SPACES_REGEX)
355 
356       dots_pos = SkipUntil(lines, pos, DOT_DOT_REGEX, '..')
357       yield MakeToken(lines, pos, dots_pos, 'exp')
358       yield MakeToken(lines, dots_pos, dots_pos + 2, '..')
359       pos = dots_pos + 2
360       new_pos = Cursor(pos.line + 1, 0)
361       yield MakeToken(lines, pos, new_pos, 'exp')
362       pos = new_pos
363     elif found.token_type == '$':
364       if prev_token:
365         yield prev_token
366       yield found
367       exp_token = ParseExpTokenInParens(lines, found.end)
368       yield exp_token
369       pos = exp_token.end
370     elif (found.token_type == ']]' or found.token_type == '$if' or
371           found.token_type == '$elif' or found.token_type == '$else'):
372       if prev_token_rstripped:
373         yield prev_token_rstripped
374       yield found
375       pos = found.end
376     else:
377       if prev_token:
378         yield prev_token
379       yield found
380       pos = found.end
381 

\end{DoxyCode}
\hypertarget{namespacepump_a47b13e91e95ce5ad82778b919b51dc0b}{\index{pump@{pump}!\-Wrap\-Code@{\-Wrap\-Code}}
\index{\-Wrap\-Code@{\-Wrap\-Code}!pump@{pump}}
\subsubsection[{\-Wrap\-Code}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Wrap\-Code} (
\begin{DoxyParamCaption}
\item[{}]{line, }
\item[{}]{line\-\_\-concat, }
\item[{}]{output}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a47b13e91e95ce5ad82778b919b51dc0b}


\-Definition at line 741 of file pump.\-py.


\begin{DoxyCode}
741 
742 def WrapCode(line, line_concat, output):
743   indent = len(line) - len(line.lstrip())
744   prefix = indent*' '  # Prefix of the current line
745   max_len = 80 - indent - len(line_concat)  # Maximum length of the current
       line
746   new_prefix = prefix + 4*' '  # Prefix of a continuation line
747   new_max_len = max_len - 4  # Maximum length of a continuation line
748   # Prefers to wrap a line after a ',' or ';'.
749   segs = [seg for seg in re.split(r'([^,;]+[,;]?)', line.strip()) if seg != '']
750   cur_line = ''  # The current line without leading spaces.
751   for seg in segs:
752     # If the line is still too long, wrap at a space.
753     while cur_line == '' and len(seg.strip()) > max_len:
754       seg = seg.lstrip()
755       split_at = seg.rfind(' ', 0, max_len)
756       output.append(prefix + seg[:split_at].strip() + line_concat)
757       seg = seg[split_at + 1:]
758       prefix = new_prefix
759       max_len = new_max_len
760 
761     if len((cur_line + seg).rstrip()) < max_len:
762       cur_line = (cur_line + seg).lstrip()
763     else:
764       output.append(prefix + cur_line.rstrip() + line_concat)
765       prefix = new_prefix
766       max_len = new_max_len
767       cur_line = seg.lstrip()
768   if cur_line.strip() != '':
769     output.append(prefix + cur_line.strip())
770 

\end{DoxyCode}
\hypertarget{namespacepump_a8677a2e43df12f97c0264c11484c93ad}{\index{pump@{pump}!\-Wrap\-Comment@{\-Wrap\-Comment}}
\index{\-Wrap\-Comment@{\-Wrap\-Comment}!pump@{pump}}
\subsubsection[{\-Wrap\-Comment}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Wrap\-Comment} (
\begin{DoxyParamCaption}
\item[{}]{line, }
\item[{}]{output}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_a8677a2e43df12f97c0264c11484c93ad}


\-Definition at line 717 of file pump.\-py.


\begin{DoxyCode}
717 
718 def WrapComment(line, output):
719   loc = line.find('//')
720   before_comment = line[:loc].rstrip()
721   if before_comment == '':
722     indent = loc
723   else:
724     output.append(before_comment)
725     indent = len(before_comment) - len(before_comment.lstrip())
726   prefix = indent*' ' + '// '
727   max_len = 80 - len(prefix)
728   comment = line[loc + 2:].strip()
729   segs = [seg for seg in re.split(r'(\w+\W*)', comment) if seg != '']
730   cur_line = ''
731   for seg in segs:
732     if len((cur_line + seg).rstrip()) < max_len:
733       cur_line += seg
734     else:
735       if cur_line.strip() != '':
736         output.append(prefix + cur_line.rstrip())
737       cur_line = seg.lstrip()
738   if cur_line.strip() != '':
739     output.append(prefix + cur_line.strip())
740 

\end{DoxyCode}
\hypertarget{namespacepump_addffcaf4dbb430aaeb7193cca96c0422}{\index{pump@{pump}!\-Wrap\-Long\-Line@{\-Wrap\-Long\-Line}}
\index{\-Wrap\-Long\-Line@{\-Wrap\-Long\-Line}!pump@{pump}}
\subsubsection[{\-Wrap\-Long\-Line}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Wrap\-Long\-Line} (
\begin{DoxyParamCaption}
\item[{}]{line, }
\item[{}]{output}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_addffcaf4dbb430aaeb7193cca96c0422}


\-Definition at line 784 of file pump.\-py.


\begin{DoxyCode}
784 
785 def WrapLongLine(line, output):
786   line = line.rstrip()
787   if len(line) <= 80:
788     output.append(line)
789   elif IsComment(line):
790     if IsHeaderGuardOrInclude(line):
791       # The style guide made an exception to allow long header guard lines
792       # and includes.
793       output.append(line)
794     else:
795       WrapComment(line, output)
796   elif IsInPreprocessorDirevative(output, line):
797     if IsHeaderGuardOrInclude(line):
798       # The style guide made an exception to allow long header guard lines
799       # and includes.
800       output.append(line)
801     else:
802       WrapPreprocessorDirevative(line, output)
803   else:
804     WrapPlainCode(line, output)
805 

\end{DoxyCode}
\hypertarget{namespacepump_aa10f49653a1076dd726c717e6498e38c}{\index{pump@{pump}!\-Wrap\-Plain\-Code@{\-Wrap\-Plain\-Code}}
\index{\-Wrap\-Plain\-Code@{\-Wrap\-Plain\-Code}!pump@{pump}}
\subsubsection[{\-Wrap\-Plain\-Code}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Wrap\-Plain\-Code} (
\begin{DoxyParamCaption}
\item[{}]{line, }
\item[{}]{output}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_aa10f49653a1076dd726c717e6498e38c}


\-Definition at line 775 of file pump.\-py.


\begin{DoxyCode}
775 
776 def WrapPlainCode(line, output):
777   WrapCode(line, '', output)
778 

\end{DoxyCode}
\hypertarget{namespacepump_ab79a373a6832251df2a3a0de88c2bb67}{\index{pump@{pump}!\-Wrap\-Preprocessor\-Direvative@{\-Wrap\-Preprocessor\-Direvative}}
\index{\-Wrap\-Preprocessor\-Direvative@{\-Wrap\-Preprocessor\-Direvative}!pump@{pump}}
\subsubsection[{\-Wrap\-Preprocessor\-Direvative}]{\setlength{\rightskip}{0pt plus 5cm}def {\bf pump.\-Wrap\-Preprocessor\-Direvative} (
\begin{DoxyParamCaption}
\item[{}]{line, }
\item[{}]{output}
\end{DoxyParamCaption}
)}}\label{df/d92/namespacepump_ab79a373a6832251df2a3a0de88c2bb67}


\-Definition at line 771 of file pump.\-py.


\begin{DoxyCode}
771 
772 def WrapPreprocessorDirevative(line, output):
773   WrapCode(line, ' \\', output)
774 

\end{DoxyCode}


\subsection{\-Variable \-Documentation}
\hypertarget{namespacepump_a629d61dfe4da763164a4d1a2d85b0afd}{\index{pump@{pump}!\-\_\-\-\_\-author\-\_\-\-\_\-@{\-\_\-\-\_\-author\-\_\-\-\_\-}}
\index{\-\_\-\-\_\-author\-\_\-\-\_\-@{\-\_\-\-\_\-author\-\_\-\-\_\-}!pump@{pump}}
\subsubsection[{\-\_\-\-\_\-author\-\_\-\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}string {\bf \-\_\-\-\_\-author\-\_\-\-\_\-} = 'wan@google.\-com (\-Zhanyong \-Wan)'}}\label{df/d92/namespacepump_a629d61dfe4da763164a4d1a2d85b0afd}


\-Definition at line 65 of file pump.\-py.

\hypertarget{namespacepump_a5267421d4c85117b52d918accf1b2cbe}{\index{pump@{pump}!\-D\-O\-T\-\_\-\-D\-O\-T\-\_\-\-R\-E\-G\-E\-X@{\-D\-O\-T\-\_\-\-D\-O\-T\-\_\-\-R\-E\-G\-E\-X}}
\index{\-D\-O\-T\-\_\-\-D\-O\-T\-\_\-\-R\-E\-G\-E\-X@{\-D\-O\-T\-\_\-\-D\-O\-T\-\_\-\-R\-E\-G\-E\-X}!pump@{pump}}
\subsubsection[{\-D\-O\-T\-\_\-\-D\-O\-T\-\_\-\-R\-E\-G\-E\-X}]{\setlength{\rightskip}{0pt plus 5cm}tuple {\bf \-D\-O\-T\-\_\-\-D\-O\-T\-\_\-\-R\-E\-G\-E\-X} = re.\-compile(r'$\backslash$.$\backslash$.')}}\label{df/d92/namespacepump_a5267421d4c85117b52d918accf1b2cbe}


\-Definition at line 258 of file pump.\-py.

\hypertarget{namespacepump_a89c455f059588c995485f69128edcb04}{\index{pump@{pump}!\-E\-Q\-\_\-\-R\-E\-G\-E\-X@{\-E\-Q\-\_\-\-R\-E\-G\-E\-X}}
\index{\-E\-Q\-\_\-\-R\-E\-G\-E\-X@{\-E\-Q\-\_\-\-R\-E\-G\-E\-X}!pump@{pump}}
\subsubsection[{\-E\-Q\-\_\-\-R\-E\-G\-E\-X}]{\setlength{\rightskip}{0pt plus 5cm}tuple {\bf \-E\-Q\-\_\-\-R\-E\-G\-E\-X} = re.\-compile(r'=')}}\label{df/d92/namespacepump_a89c455f059588c995485f69128edcb04}


\-Definition at line 254 of file pump.\-py.

\hypertarget{namespacepump_a72ec68ae8b1a6794caed2e023ad35d0d}{\index{pump@{pump}!\-I\-D\-\_\-\-R\-E\-G\-E\-X@{\-I\-D\-\_\-\-R\-E\-G\-E\-X}}
\index{\-I\-D\-\_\-\-R\-E\-G\-E\-X@{\-I\-D\-\_\-\-R\-E\-G\-E\-X}!pump@{pump}}
\subsubsection[{\-I\-D\-\_\-\-R\-E\-G\-E\-X}]{\setlength{\rightskip}{0pt plus 5cm}tuple {\bf \-I\-D\-\_\-\-R\-E\-G\-E\-X} = re.\-compile(r'\mbox{[}\-\_\-\-A-\/\-Za-\/z\mbox{]}$\backslash$w$\ast$')}}\label{df/d92/namespacepump_a72ec68ae8b1a6794caed2e023ad35d0d}


\-Definition at line 253 of file pump.\-py.

\hypertarget{namespacepump_a72547bba10d6b0d28381a17d46fcddff}{\index{pump@{pump}!\-O\-P\-T\-I\-O\-N\-A\-L\-\_\-\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-S\-\_\-\-R\-E\-G\-E\-X@{\-O\-P\-T\-I\-O\-N\-A\-L\-\_\-\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-S\-\_\-\-R\-E\-G\-E\-X}}
\index{\-O\-P\-T\-I\-O\-N\-A\-L\-\_\-\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-S\-\_\-\-R\-E\-G\-E\-X@{\-O\-P\-T\-I\-O\-N\-A\-L\-\_\-\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-S\-\_\-\-R\-E\-G\-E\-X}!pump@{pump}}
\subsubsection[{\-O\-P\-T\-I\-O\-N\-A\-L\-\_\-\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-S\-\_\-\-R\-E\-G\-E\-X}]{\setlength{\rightskip}{0pt plus 5cm}tuple {\bf \-O\-P\-T\-I\-O\-N\-A\-L\-\_\-\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-S\-\_\-\-R\-E\-G\-E\-X} = re.\-compile(r'$\backslash$s$\ast$')}}\label{df/d92/namespacepump_a72547bba10d6b0d28381a17d46fcddff}


\-Definition at line 256 of file pump.\-py.

\hypertarget{namespacepump_a3a8b691d5bf29c19ae673e3f3b8aeb03}{\index{pump@{pump}!\-R\-E\-S\-T\-\_\-\-O\-F\-\_\-\-L\-I\-N\-E\-\_\-\-R\-E\-G\-E\-X@{\-R\-E\-S\-T\-\_\-\-O\-F\-\_\-\-L\-I\-N\-E\-\_\-\-R\-E\-G\-E\-X}}
\index{\-R\-E\-S\-T\-\_\-\-O\-F\-\_\-\-L\-I\-N\-E\-\_\-\-R\-E\-G\-E\-X@{\-R\-E\-S\-T\-\_\-\-O\-F\-\_\-\-L\-I\-N\-E\-\_\-\-R\-E\-G\-E\-X}!pump@{pump}}
\subsubsection[{\-R\-E\-S\-T\-\_\-\-O\-F\-\_\-\-L\-I\-N\-E\-\_\-\-R\-E\-G\-E\-X}]{\setlength{\rightskip}{0pt plus 5cm}tuple {\bf \-R\-E\-S\-T\-\_\-\-O\-F\-\_\-\-L\-I\-N\-E\-\_\-\-R\-E\-G\-E\-X} = re.\-compile(r'.$\ast$?(?=\$$|$$\backslash$\$$\backslash$\$)')}}\label{df/d92/namespacepump_a3a8b691d5bf29c19ae673e3f3b8aeb03}


\-Definition at line 255 of file pump.\-py.

\hypertarget{namespacepump_a6bd373dabbdfeaf3ec7a5e80d5bba44f}{\index{pump@{pump}!\-T\-O\-K\-E\-N\-\_\-\-T\-A\-B\-L\-E@{\-T\-O\-K\-E\-N\-\_\-\-T\-A\-B\-L\-E}}
\index{\-T\-O\-K\-E\-N\-\_\-\-T\-A\-B\-L\-E@{\-T\-O\-K\-E\-N\-\_\-\-T\-A\-B\-L\-E}!pump@{pump}}
\subsubsection[{\-T\-O\-K\-E\-N\-\_\-\-T\-A\-B\-L\-E}]{\setlength{\rightskip}{0pt plus 5cm}list {\bf \-T\-O\-K\-E\-N\-\_\-\-T\-A\-B\-L\-E}}}\label{df/d92/namespacepump_a6bd373dabbdfeaf3ec7a5e80d5bba44f}
{\bfseries \-Initial value\-:}
\begin{DoxyCode}
1 [
2     (re.compile(r'\$var\s+'), '$var'),
3     (re.compile(r'\$elif\s+'), '$elif'),
4     (re.compile(r'\$else\s+'), '$else'),
5     (re.compile(r'\$for\s+'), '$for'),
6     (re.compile(r'\$if\s+'), '$if'),
7     (re.compile(r'\$range\s+'), '$range'),
8     (re.compile(r'\$[_A-Za-z]\w*'), '$id'),
9     (re.compile(r'\$\(\$\)'), '$($)'),
10     (re.compile(r'\$'), '$'),
11     (re.compile(r'\[\[\n?'), '[['),
12     (re.compile(r'\]\]\n?'), ']]'),
13     ]
\end{DoxyCode}


\-Definition at line 72 of file pump.\-py.

\hypertarget{namespacepump_afdbcc81876235b538ea355fcd2193bbd}{\index{pump@{pump}!\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-\_\-\-R\-E\-G\-E\-X@{\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-\_\-\-R\-E\-G\-E\-X}}
\index{\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-\_\-\-R\-E\-G\-E\-X@{\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-\_\-\-R\-E\-G\-E\-X}!pump@{pump}}
\subsubsection[{\-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-\_\-\-R\-E\-G\-E\-X}]{\setlength{\rightskip}{0pt plus 5cm}tuple {\bf \-W\-H\-I\-T\-E\-\_\-\-S\-P\-A\-C\-E\-\_\-\-R\-E\-G\-E\-X} = re.\-compile(r'$\backslash$s')}}\label{df/d92/namespacepump_afdbcc81876235b538ea355fcd2193bbd}


\-Definition at line 257 of file pump.\-py.

